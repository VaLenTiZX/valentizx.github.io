<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.3.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.3.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.3.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '6.3.0',
    sidebar: {"position":"right","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="「RSHARE」 一键分享 iOS 版写这个 RSHARE 并不是想得到 Github 多少星, 抑或是激起多大的风浪, 是因为公司的项目里集成了一键分享的这个模块, 而在我设计的时候发现国内的官方文档和提供的 Sample 有混乱和容易混淆的地方, 而且除了普通的网页、图片、文字分享到各大 Social 平台以外, 对于视频、文件和其他内容的分享 Demo 在百度或者 Google 几乎搜不到.">
<meta property="og:type" content="article">
<meta property="og:title" content="I&#39;M REXZX">
<meta property="og:url" content="http://yoursite.com/2018/06/29/rshare_ios_vesion/index.html">
<meta property="og:site_name" content="I&#39;M REXZX">
<meta property="og:description" content="「RSHARE」 一键分享 iOS 版写这个 RSHARE 并不是想得到 Github 多少星, 抑或是激起多大的风浪, 是因为公司的项目里集成了一键分享的这个模块, 而在我设计的时候发现国内的官方文档和提供的 Sample 有混乱和容易混淆的地方, 而且除了普通的网页、图片、文字分享到各大 Social 平台以外, 对于视频、文件和其他内容的分享 Demo 在百度或者 Google 几乎搜不到.">
<meta property="og:locale" content="default">
<meta property="og:image" content="http://yoursite.com/2018/06/29/rshare_ios_vesion/media/15302429730401/15347546981023.jpg">
<meta property="og:image" content="http://yoursite.com/2018/06/29/rshare_ios_vesion/media/15302429730401/15347552092936.jpg">
<meta property="og:image" content="http://yoursite.com/2018/06/29/rshare_ios_vesion/media/15302429730401/15347555596950.jpg">
<meta property="og:image" content="http://yoursite.com/2018/06/29/rshare_ios_vesion/media/15302429730401/15347575567275.jpg">
<meta property="og:image" content="http://yoursite.com/2018/06/29/rshare_ios_vesion/media/15302429730401/15347580675537.jpg">
<meta property="og:image" content="http://yoursite.com/2018/06/29/rshare_ios_vesion/media/15302429730401/15348336900423.jpg">
<meta property="og:image" content="http://yoursite.com/2018/06/29/rshare_ios_vesion/media/15302429730401/15348339515124.jpg">
<meta property="og:image" content="http://yoursite.com/2018/06/29/rshare_ios_vesion/media/15302429730401/15348363450963.jpg">
<meta property="og:image" content="http://yoursite.com/2018/06/29/rshare_ios_vesion/media/15302429730401/15348363567791.jpg">
<meta property="og:image" content="http://yoursite.com/2018/06/29/rshare_ios_vesion/media/15302429730401/15348443067160.jpg">
<meta property="og:image" content="http://yoursite.com/2018/06/29/rshare_ios_vesion/media/15302429730401/15348439011768.jpg">
<meta property="og:image" content="http://yoursite.com/2018/06/29/rshare_ios_vesion/media/15302429730401/15348440110029.jpg">
<meta property="og:image" content="http://yoursite.com/2018/06/29/rshare_ios_vesion/media/15302429730401/15349284763521.jpg">
<meta property="og:image" content="http://yoursite.com/2018/06/29/rshare_ios_vesion/media/15302429730401/15350068215466.jpg">
<meta property="og:image" content="http://yoursite.com/2018/06/29/rshare_ios_vesion/media/15302429730401/15353508681576.jpg">
<meta property="og:image" content="http://yoursite.com/2018/06/29/rshare_ios_vesion/media/15302429730401/15354210062698.jpg">
<meta property="og:image" content="http://yoursite.com/2018/06/29/rshare_ios_vesion/media/15302429730401/15354232020858.jpg">
<meta property="og:image" content="http://yoursite.com/2018/06/29/rshare_ios_vesion/media/15302429730401/15354229930666.jpg">
<meta property="og:image" content="http://yoursite.com/2018/06/29/rshare_ios_vesion/media/15302429730401/15354345270701.jpg">
<meta property="og:image" content="http://yoursite.com/2018/06/29/rshare_ios_vesion/media/15302429730401/15354346583127.jpg">
<meta property="og:image" content="http://yoursite.com/2018/06/29/rshare_ios_vesion/media/15302429730401/15354355909817.jpg">
<meta property="og:image" content="http://yoursite.com/2018/06/29/rshare_ios_vesion/media/15302429730401/WechatIMG450.jpg">
<meta property="og:image" content="http://yoursite.com/2018/06/29/rshare_ios_vesion/media/15302429730401/15354368096708.jpg">
<meta property="og:image" content="http://yoursite.com/2018/06/29/rshare_ios_vesion/media/15302429730401/iOS%20%E5%88%86%E4%BA%AB%E7%BB%9F%E4%B8%80%E6%8E%A5%E5%8F%A3%E7%B1%BB%E5%9B%BE.png">
<meta property="og:updated_time" content="2018-08-28T08:57:06.064Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="I&#39;M REXZX">
<meta name="twitter:description" content="「RSHARE」 一键分享 iOS 版写这个 RSHARE 并不是想得到 Github 多少星, 抑或是激起多大的风浪, 是因为公司的项目里集成了一键分享的这个模块, 而在我设计的时候发现国内的官方文档和提供的 Sample 有混乱和容易混淆的地方, 而且除了普通的网页、图片、文字分享到各大 Social 平台以外, 对于视频、文件和其他内容的分享 Demo 在百度或者 Google 几乎搜不到.">
<meta name="twitter:image" content="http://yoursite.com/2018/06/29/rshare_ios_vesion/media/15302429730401/15347546981023.jpg">






  <link rel="canonical" href="http://yoursite.com/2018/06/29/rshare_ios_vesion/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title> | I'M REXZX</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-right page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">I'M REXZX</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />Home</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-about">
    <a href="/about/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-user"></i> <br />About</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />Tags</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br />Categories</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />Archives</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-commonweal">
    <a href="/404/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />Commonweal 404</a>
  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/29/rshare_ios_vesion/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="曾經滄海難為水 除卻巫山不是雲">
      <meta itemprop="image" content="/images/logo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="I'M REXZX">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-06-29 11:29:33" itemprop="dateCreated datePublished" datetime="2018-06-29T11:29:33+08:00">2018-06-29</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-08-28 16:57:06" itemprop="dateModified" datetime="2018-08-28T16:57:06+08:00">2018-08-28</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="「RSHARE」-一键分享-iOS-版"><a href="#「RSHARE」-一键分享-iOS-版" class="headerlink" title="「RSHARE」 一键分享 iOS 版"></a>「RSHARE」 一键分享 iOS 版</h1><p>写这个 RSHARE 并不是想得到 Github 多少星, 抑或是激起多大的风浪, 是因为公司的项目里集成了一键分享的这个模块, 而在我设计的时候发现国内的官方文档和提供的 Sample 有混乱和容易混淆的地方, 而且除了普通的网页、图片、文字分享到各大 Social 平台以外, 对于视频、文件和其他内容的分享 Demo 在百度或者 Google 几乎搜不到. 自己也是踩了很多坑才把很多问题解决.</p>
<h3 id="测试设备"><a href="#测试设备" class="headerlink" title="测试设备"></a>测试设备</h3><p>iPhone 7 Plus, iOS 11.4.1.</p>
<h3 id="1-支持平台"><a href="#1-支持平台" class="headerlink" title="1 支持平台"></a>1 支持平台</h3><p><strong>RSHARE</strong> 这个 Demo 中支持: 微信、QQ、新浪微博、Facebook、GooglePlus(Google +)、Twitter、WhatsApp、Line、Tumblr、Instagram、Pinterest 11 个 Social 平台.</p>
<h4 id="1-1-平台差异"><a href="#1-1-平台差异" class="headerlink" title="1.1 平台差异"></a>1.1 平台差异</h4><p>主要罗列了常用的 5 个分享内容的对比菜单(网页、文字、图片、本地视频、文件).<br><strong>注意菜单内字母以及菜单后面对应字母的注释⚠️</strong></p>
<table>
<thead>
<tr>
<th>❤️</th>
<th>QQ</th>
<th>微信</th>
<th>微博</th>
<th>Facebook</th>
<th>Twitter</th>
<th>Instagram</th>
<th>WhatsApp</th>
<th>Line</th>
<th>Tumblr</th>
<th>Pinterest</th>
<th>Google+</th>
</tr>
</thead>
<tbody>
<tr>
<td>网页</td>
<td>✓a</td>
<td>✓</td>
<td>✓</td>
<td>✓b</td>
<td>✓</td>
<td>✗</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✗</td>
<td>✓</td>
</tr>
<tr>
<td>文字</td>
<td>✓c</td>
<td>✓</td>
<td>✓</td>
<td>✗</td>
<td>✓</td>
<td>✗</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✗</td>
<td>✗</td>
</tr>
<tr>
<td>图片</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓d</td>
<td>✓d</td>
<td>✗</td>
</tr>
<tr>
<td>视频</td>
<td>?e</td>
<td>✗</td>
<td>✓</td>
<td>✓</td>
<td>✗</td>
<td>✓</td>
<td>✗</td>
<td>✗</td>
<td>✗</td>
<td>✗</td>
<td>✗</td>
</tr>
<tr>
<td>文件</td>
<td>✓</td>
<td>✓</td>
<td>✗</td>
<td>✗</td>
<td>✗</td>
<td>✗</td>
<td>✗</td>
<td>✗</td>
<td>✗</td>
<td>✗</td>
<td>✗</td>
</tr>
</tbody>
</table>
<p>a. QQ 虽支持网页分享, 但是不允许带着网页的 <figure class="highlight plain"><figcaption><span>字段, 且分享到 QQ 空间只支持通过文字分享, 这和 Android 表现不同;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">b. Facebook 的网页分享支持 **hashtag**;</span><br><span class="line">c. iOS 端分享文字到 QQ 客户端是可行的, 但是 Android 端不允许, 其实 QQ 的分享目地就是**让用户自行输入有价值、有意义的文字信息**, 这样可以过滤一部分广告, 但是 iOS 和 Android 端的不统一实在是不应该;</span><br><span class="line">d. Pinterest 和 Tumblr 虽支持图片分享, 但仅仅支持分享图片的 URL, 它会自行解析并显示;</span><br><span class="line">e. QQ 客户端分享分两类: 1 好友、收藏、数据线(我的电脑)分享; 2 QQ 空间分享. 本地视频的分享只支持 QQ 空间分享.</span><br><span class="line"></span><br><span class="line">&gt; 1. 对比列表得知, 国内的平台分享内容是最丰富的, 但是存在一个主要的问题(主要是 QQ), iOS 和 Android 双端的接口以及实现的功能也并不统一(后面的部分会具体说); 微信双端当分享的图片过大的时候的表现也有不统一的时候, 其余都很完善; 新浪的表现是个人最满意的, 没有过多限制; 国内的平台分享最让人头疼的就是官方的 Sample, 真的混乱, 但是个人还是主张, 在实践代码的时候一定要看官方的文档和 Sample.</span><br><span class="line">&gt; 2. 国外的文档和 Sample 就舒服很多了, 注释明了且详细, 但也存在双端不统一的情况, Twitter 的双端表现就不一样(后面细说), 但是国外的平台分享几乎没有回调, 这是令人头疼的, Facebook 的回调只有 Feed 形式的分享才有效, Instagram、Line、Google+这些是没有 SDK 的, 仅仅是通过打开Application URL scheme 来分享.</span><br><span class="line"></span><br><span class="line">### 2 分享总体设计</span><br><span class="line"></span><br><span class="line">大概的分享逻辑如下:</span><br><span class="line"></span><br><span class="line">![iOS 分享逻辑](media/15302429730401/iOS%20%E5%88%86%E4%BA%AB%E9%80%BB%E8%BE%91.png)</span><br><span class="line"></span><br><span class="line">iOS 的分享是参照各大平台的分享逻辑得到比较统一思路, 即: 先判断是否安装对应应用, 然后初始化 SDK 与官方平台连接, 然后包装分享参数进行分享, 最后处理分享回调.</span><br><span class="line">&gt; 1. 有些平台不存在 SDK, 所以直接判断是否平台安装然后包装分享参数进行分享;</span><br><span class="line">&gt; 2. Tumblr 比较特殊, 有 SDK 但是不需要判断应用是否安装就可以分享, Twitter 也如此, 具体情况在 Twitter 的部分说明;</span><br><span class="line">&gt; 3. SDK 的初始化, 我统一函数名字为 ```sdkInitialize```, ```Key```、```Secret```以及```AppID```等信息在参数列表中有标明.</span><br><span class="line"></span><br><span class="line">### 3 详细逻辑</span><br><span class="line"></span><br><span class="line">**关于各个平台的开发者主页和文档信息以这里为主, 代码注释的可能不准确.**</span><br><span class="line"></span><br><span class="line">平台分享都是通过**单例模式**实现。</span><br><span class="line"></span><br><span class="line">**在手动导入框架的时候尽量, 放在项目根目录下然后通过下图的方式导入:**</span><br><span class="line">![](media/15302429730401/15347454711633.jpg)</span><br><span class="line">&gt; 在项目级 ```Framework``` 目录下右键执行 ```Add Files to &quot;name&quot;```.</span><br><span class="line"></span><br><span class="line">子平台分享完毕**返回到本应用**的接口再封装 Objective-C 版本用的是**实例方法**, Swift 版本使用的是**类方法**.</span><br><span class="line"></span><br><span class="line">#### 3.0 基类</span><br><span class="line">基类都是继承自**RShare**, 这个类中定义了分享 **Mode(代码注释中有标明, iOS 中使用范围较小)**、分享结果 **ShareResult** (成功、取消、失败)以及最重要的**回调**,</span><br><span class="line"></span><br><span class="line">**回调:**</span><br><span class="line">Objective-C:</span><br><span class="line"></span><br><span class="line">```objc</span><br><span class="line">typedef void (^RShareCompletion)(RShareSDKPlatform platform, ShareResult result, NSString* _Nullable errorInfo);</span><br></pre></td></tr></table></figure></p>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typealias</span> <span class="type">RShareCompletion</span> = (<span class="number">_</span> paltform : <span class="type">RShareSDKPlatform</span>,<span class="number">_</span> result : <span class="type">ShareResult</span>,<span class="number">_</span> errorInfo : <span class="type">String</span>?) -&gt; <span class="type">Void</span></span><br></pre></td></tr></table></figure>
<p><strong>Mode(仅对 Facebook、Twitter、Instagram 有效, Android 亦然):</strong><br>Objective-C:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="built_in">NS_ENUM</span>(<span class="built_in">NSInteger</span>, Mode) &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     @Displays 优先选择原生应用分享, 原生应用未安装的情况可能跳转内置 WebView 或者 Safari 进行分享.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ShareModeAutomatic,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     @Displays 原生应用分享.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ShareModeNative,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     @Displays 应用内置 UIWebView 分享.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ShareModeWeb,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     @Displays the dialog in the iOS integrated share sheet, 仅对 Facebook 分享有效.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ShareModeSheet,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     @Displays 跳转至 Safari 分享, 仅对 Facebook 分享有效.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ShareModeBrowser,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     @Displays 跳转至 Safari 进行 Feed 形式的分享, 仅对 Facebook 分享有效.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ShareModeFeedBrowser,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     @Displays 应用内置 UIWebView 的 Feed 形式分享, 仅对 Facebook 分享有效.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ShareModeFeed,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     @Displays iOS 的系统分享.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ShareModeSystem</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="3-1-QQ"><a href="#3-1-QQ" class="headerlink" title="3.1 QQ"></a>3.1 QQ</h4><h5 id="3-1-1-准备"><a href="#3-1-1-准备" class="headerlink" title="3.1.1 准备"></a>3.1.1 准备</h5><p>分享需要注册平台, <a href="http://open.qq.com/" target="_blank" rel="noopener">腾讯开发者主页</a>, <a href="http://wiki.open.qq.com/wiki/mobile/SDK%E4%B8%8B%E8%BD%BD" target="_blank" rel="noopener">SDK 下载</a>, QQ SDK 目前<strong>不支持 pod 安装</strong>, iOS API 调用说明<a href="http://wiki.open.qq.com/index.php?title=iOS_API%E8%B0%83%E7%94%A8%E8%AF%B4%E6%98%8E&amp;oldid=46716" target="_blank" rel="noopener">文档</a>.</p>
<h5 id="3-1-2-集成"><a href="#3-1-2-集成" class="headerlink" title="3.1.2 集成"></a>3.1.2 集成</h5><p>a. <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">b. 添加系统依赖```Security.framework```、```SystemConfiguration.framework```、```CoreGraphic.framework```、```libsqilte3.0.tbd```、```CoreTelephony.framework```、```libz.tbd```.</span><br><span class="line">c. 设置 **The Other Flags** 为 **-ObjC**.</span><br><span class="line">d. 在```info.plist```文件的```CFBundleURLTypes```中添加:</span><br><span class="line"></span><br><span class="line">```objc</span><br><span class="line">&lt;key&gt;CFBundleURLSchemes&lt;/key&gt;</span><br><span class="line">&lt;array&gt;</span><br><span class="line">    &lt;string&gt;tencentYOURAPPID&lt;/string&gt;</span><br><span class="line">&lt;/array&gt;</span><br></pre></td></tr></table></figure></p>
<p>e. 添加以下至白名单:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;string&gt;mqq&lt;/string&gt;</span><br><span class="line">&lt;string&gt;mqqapi&lt;/string&gt;</span><br><span class="line">&lt;string&gt;mqqwpa&lt;/string&gt;</span><br><span class="line">&lt;string&gt;mqqbrowser&lt;/string&gt;</span><br><span class="line">&lt;string&gt;mttbrowser&lt;/string&gt;</span><br><span class="line">&lt;string&gt;mqqOpensdkSSoLogin&lt;/string&gt;</span><br><span class="line">&lt;string&gt;mqqopensdkapiV2&lt;/string&gt;</span><br><span class="line">&lt;string&gt;mqqopensdkapiV3&lt;/string&gt;</span><br><span class="line">&lt;string&gt;mqqopensdkapiV4&lt;/string&gt;</span><br><span class="line">&lt;string&gt;wtloginmqq2&lt;/string&gt;</span><br><span class="line">&lt;string&gt;mqzone&lt;/string&gt;</span><br><span class="line">&lt;string&gt;mqzoneopensdk&lt;/string&gt;</span><br><span class="line">&lt;string&gt;mqzoneopensdkapi&lt;/string&gt;</span><br><span class="line">&lt;string&gt;mqzoneopensdkapi19&lt;/string&gt;</span><br><span class="line">&lt;string&gt;mqzoneopensdkapiV2&lt;/string&gt;</span><br><span class="line">&lt;string&gt;mqqapiwallet&lt;/string&gt;</span><br><span class="line">&lt;string&gt;mqqopensdkfriend&lt;/string&gt;</span><br><span class="line">&lt;string&gt;mqqopensdkdataline&lt;/string&gt;</span><br><span class="line">&lt;string&gt;mqqgamebindinggroup&lt;/string&gt;</span><br><span class="line">&lt;string&gt;mqqopensdkgrouptribeshare&lt;/string&gt;</span><br><span class="line">&lt;string&gt;tencentapi.qq.reqContent&lt;/string&gt;</span><br><span class="line">&lt;string&gt;tencentapi.qzone.reqContent&lt;/string&gt;</span><br></pre></td></tr></table></figure>
<p>f. Swift 语言集成需要 <strong>Objective-C - Swift 桥接文件</strong>.</p>
<h5 id="3-1-3-接口调用及内部实现"><a href="#3-1-3-接口调用及内部实现" class="headerlink" title="3.1.3 接口调用及内部实现"></a>3.1.3 接口调用及内部实现</h5><p><strong>a. 初始化 SDK</strong></p>
<p>Objective-C:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[RQqManager shared] sdkInitializeByAppID:yourAppId appKey:yourAppKey];</span><br></pre></td></tr></table></figure>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RQqManager</span>.shared.sdkInitialize(appID: yourAppId, appKey: yourAppKey)</span><br></pre></td></tr></table></figure>
<p>内部实现 (Objective-C):</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[TencentOAuth alloc]initWithAppId:appID andDelegate:<span class="keyword">self</span>];</span><br></pre></td></tr></table></figure>
<blockquote>
<p>由此看出, 其实仅仅是用作<strong><em>分享</em></strong>功能的话, 是不需要<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**b. 分享**</span><br><span class="line"></span><br><span class="line">对于分享内容的包装, 通过建立 **RQqHelper** 来实现分享内容的处理和平台 **Manager** 的分隔, 这样有利于逻辑的处理, 结构明显, 代码可控.</span><br><span class="line">关于参数包装的细节, 没什么好细说的, QQ 提供的接口简单明了(Android 不是这样).</span><br><span class="line"></span><br><span class="line">另, 除在 ```QQApiInterfaceDelegate``` 代理函数 ```- (void)onResp:(QQBaseResp *)resp``` 中处理分享回调外, 在发起手 Q 分享请求的接口 ```[QQApiInterface sendReq: request]``` 返回的 **QQApiSendResultCode** 做了**分享失败的请求码**处理, Objective-C 中单独建立的处理函数 ```- (void)handleResultCode:(QQApiSendResultCode)code```, Swift 则直接在 **resultCode** 的 ```set 方法```处理.</span><br><span class="line"></span><br><span class="line">分享到 QQ 的接口中 ```scene``` 字段细分到 QQ 好友、我的收藏、数据线(我的电脑), **但 Android 中不支持直接打开‘我的收藏’和‘数据线(我的电脑)’面板, 须自行选择.**</span><br><span class="line"></span><br><span class="line">**文字分享:**</span><br><span class="line"></span><br><span class="line">Objective-C:</span><br><span class="line"></span><br><span class="line">```objc</span><br><span class="line">[[RQqManager shared] shareTextToQQ:text scene:scene completion:completion];</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RQqManager</span>.shared.share(text: text, scene: scene, completion: completion)</span><br></pre></td></tr></table></figure>
<p>表现(QQ 好友分享):<br><img src="media/15302429730401/15347546981023.jpg" alt="QQ 文字分享"></p>
<p><strong>图片分享:</strong></p>
<p>Objective-C:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[RQqManager shared] shareImageToQQ:targetImage title:title description:description scene:scene completion:completion];</span><br></pre></td></tr></table></figure>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RQqManager</span>.shared.share(image: targetImage, title: title, description: description, scene: scene, completion: completion)</span><br></pre></td></tr></table></figure>
<p>表现(QQ 好友分享且分享面板样式):<br><img src="media/15302429730401/15347552092936.jpg" alt="图片分享"></p>
<p><strong>网页分享:</strong></p>
<p>Objective-C:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[RQqManager shared] shareWebpageToQQWithURL:webpageURL title:title description:description thumbImage:image scene:scene completion:completion];</span><br></pre></td></tr></table></figure>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RQqManager</span>.shared.share(webpageURL: webpageURL, title: title, description: description, thumbImage: image, scene: scene, completion: completion)</span><br></pre></td></tr></table></figure>
<p>表现(QQ 好友分享):<br><img src="media/15302429730401/15347555596950.jpg" alt=""></p>
<p><strong>视频链分享:</strong><br>实质就是网页的分享, 在此不作代码示例.</p>
<p><strong>音频链分享:</strong><br>大致和网页的分享相同, 但是多了一个 <figure class="highlight plain"><figcaption><span>的字段.</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Objective-C:</span><br><span class="line"></span><br><span class="line">```objc</span><br><span class="line">[[RQqManager shared] shareAudioToQQWithStreamURL:audioStreamURL title:title description:description thumbImage:image webpageURL:webpageURL scene:scene completion: completion];</span><br></pre></td></tr></table></figure></p>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RQqManager</span>.shared.share(audioStreamURL: audioStreamURL, title: title, description: description, thumbImage: image, webpageURL: webpageURL, scene: scene, completion: completion)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>⚠️ 1.<figure class="highlight plain"><figcaption><span>中 ```QQApiVideoObject```的```flashURL```属性设置音频流.</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt;⚠️ 2. ```audioStreamURL``` 请设置音频的音频流链接, 不要把音乐平台分享的音乐网链直接赋值在该字段上, 否则点击播放按钮是无法播放的, 音乐网链是放在 ```webpageURL``` 字段上的.</span><br><span class="line"></span><br><span class="line">表现(QQ 好友分享):</span><br><span class="line">![](media/15302429730401/15347561122085.jpg)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**文件分享:**</span><br><span class="line"></span><br><span class="line">Objective-C:</span><br><span class="line"></span><br><span class="line">```objc </span><br><span class="line">[[RQqManager shared] shareFileToQQWithFileData:fileData fileName:fileName title:title description:description thumbImage:image completion: completion];</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RQqManager</span>.shared.share(fileData: filedata, fileName: fileName, title: title, description: description, thumbImage: image, compeltion: completion)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>⚠️ 1. <figure class="highlight plain"><figcaption><span>字段设置方式是: ‘文件名’+‘.扩展名’, 形如:HelloWorld.doc, 这样 QQ 系统内部能够解析并且可以友好的展示分享内容, 经测试大部分常规的文件都能友好的展示.</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&gt; ⚠️ 2. 文件分享**只支持** QQ 客户端数据线(我的电脑)分享, 并且 Android 端无法分享文件, 也或许其实是可以分享文件只不过本人技拙没发现实现方法罢.</span><br><span class="line"></span><br><span class="line">表现(以视频为例):</span><br><span class="line">![](media/15302429730401/15347572831666.jpg)</span><br><span class="line">![](media/15302429730401/15347572964976.jpg)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**文字分享到 QQ 空间:**</span><br><span class="line"></span><br><span class="line">Objective-C:</span><br><span class="line"></span><br><span class="line">```objc</span><br><span class="line">[[RQqManager shared] shareTextToQZone:description completion: completion];</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RQqManager</span>.shared.share(text: description, completion: completion)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>⚠️ Android 端不支持纯文字分享到 QQ 空间, 且 iOS 端不支持网页分享到 QQ 空间, 除非把字符串形式的网链通过文字的方式分享, 这是可行的.</p>
</blockquote>
<p>表现:<br><img src="media/15302429730401/15347575567275.jpg" alt=""></p>
<p><strong>分享图片到 QQ 空间:</strong></p>
<p>Objective-C:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[RQqManager shared] shareImagesToQZone: targetImageArray  description:description completion: completion];</span><br></pre></td></tr></table></figure>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RQqManager</span>.shared.share(images: targetImageArray, description: description, completion: completion)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>⚠️ <figure class="highlight plain"><figcaption><span>字段实际是失效的, 但不保证未来一定不用这个字段, 所以暂且保留这个字段.</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">表现:</span><br><span class="line"></span><br><span class="line">![](media/15302429730401/15347578492625.jpg)</span><br><span class="line"></span><br><span class="line">**分享本地视频到 QQ 空间:**</span><br><span class="line"></span><br><span class="line">Objective-C:</span><br><span class="line"></span><br><span class="line">```objc</span><br><span class="line">[[RQqManager shared] shareVideoToQZoneWithAssetURL:videoAssetURL description:description completion: completion];</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RQqManager</span>.shared.share(videoAssetURL: videoAssetURL, description: description, completion: completion)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>⚠️ 1. <figure class="highlight plain"><figcaption><span>字段实际是失效的, 但不保证未来一定不用这个字段, 所以暂且保留这个字段.</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;⚠️ 2. 本地视频 URL 为通过 ```UIImagePickerController``` 选择的媒体 **info** 的 ```UIImagePickerControllerReferenceURL``` 的值:</span><br><span class="line">&gt;Objective-C:</span><br><span class="line">&gt;</span><br><span class="line">&gt; ```objc</span><br><span class="line">&gt; videoURL = [info objectForKey:UIImagePickerControllerReferenceURL];</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<blockquote>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; videoURL = info[<span class="type">UIImagePickerControllerReferenceURL</span>]</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p><strong>形如: assets-library://asset/asset.MP4?id=8FF2F03F-DD84-41A5-A20C-B745E793C0DC&amp;ext=MP4</strong></p>
</blockquote>
<p>表现:<br><img src="media/15302429730401/15347580675537.jpg" alt=""></p>
<p><strong>c. 返回本应用</strong></p>
<p>Objective-C:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[RQqManager shared] application:app openURL:url options: options];</span><br></pre></td></tr></table></figure>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RQqManager</span>.application(app, <span class="keyword">open</span>: url, options : options)</span><br></pre></td></tr></table></figure>
<h4 id="3-2-微信"><a href="#3-2-微信" class="headerlink" title="3.2 微信"></a>3.2 微信</h4><h5 id="3-2-1-准备"><a href="#3-2-1-准备" class="headerlink" title="3.2.1 准备"></a>3.2.1 准备</h5><p>分享需要注册平台, <a href="https://open.weixin.qq.com/" target="_blank" rel="noopener">微信开放平台</a>, <a href="https://open.weixin.qq.com/cgi-bin/showdocument?action=dir_list&amp;t=resource/res_list&amp;verify=1&amp;id=open1419319164&amp;token=015161c07a6a155cf6424904a9febe4301efaa49&amp;lang=zh_CN" target="_blank" rel="noopener">SDK 下载</a>, 微信 SDK <strong>支持 pod 安装</strong>, <a href="https://open.weixin.qq.com/cgi-bin/showdocument?action=dir_list&amp;t=resource/res_list&amp;verify=1&amp;id=open1419317332&amp;token=&amp;lang=zh_CN" target="_blank" rel="noopener">分享 &amp; 收藏 API 调用说明</a>.</p>
<h5 id="3-2-2-集成"><a href="#3-2-2-集成" class="headerlink" title="3.2.2 集成"></a>3.2.2 集成</h5><p>a. 手动: <figure class="highlight plain"><figcaption><span>导入项目中;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">pod 集成: ```pod &apos;WechatOpenSDK&apos;```, 若出现:</span><br><span class="line">&gt; Use the $(inherited) flag, or</span><br><span class="line">&gt; Remove the build settings from the target.</span><br><span class="line">&gt; 🔧解决方法(引自[微信集成说明](https://open.weixin.qq.com/cgi-bin/showdocument?action=dir_list&amp;t=resource/res_list&amp;verify=1&amp;id=1417694084&amp;token=&amp;lang=zh_CN), 未亲自测试): 把工程 target 中的 build Setting 里面 **PODS_ROOT** 的值替换成 **\$(inherited)**, **Other Linker Flags** 中 **-all_load** 替换成\$(inherited).</span><br><span class="line"></span><br><span class="line">b. 添加系统依赖 ```SystemConfiguration.framework```, ```libz.dylib```, ```libsqlite3.0.dylib```, ```libc++.dylib```, ```Security.framework```, ```CoreTelephony.framework```, ```CFNetwork.framework```.</span><br><span class="line">c. 手动集成的情况下, 需设置 **The Other Flags** 为 **-ObjC**.</span><br><span class="line">d. 在```info.plist```文件的```CFBundleURLTypes```中添加:</span><br><span class="line"></span><br><span class="line">```objc</span><br><span class="line">&lt;key&gt;CFBundleURLSchemes&lt;/key&gt;</span><br><span class="line">&lt;array&gt;</span><br><span class="line">    &lt;string&gt;wxYOURAPPID&lt;/string&gt;</span><br><span class="line">&lt;/array&gt;</span><br></pre></td></tr></table></figure></p>
<p>e. 添加以下至白名单:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;string&gt;weixin&lt;/string&gt;</span><br><span class="line">&lt;string&gt;wechat&lt;/string&gt;</span><br></pre></td></tr></table></figure>
<p>f. Swift 语言集成需要 <strong>Objective-C - Swift 桥接文件</strong>.</p>
<h5 id="3-2-3-接口调用及内部实现"><a href="#3-2-3-接口调用及内部实现" class="headerlink" title="3.2.3 接口调用及内部实现"></a>3.2.3 接口调用及内部实现</h5><p><strong>a. 初始化 SDK</strong></p>
<p>Objective-C:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[RWechatManager shared] sdkInitializeByAppID:appID appSecret:secret];</span><br></pre></td></tr></table></figure>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RWechatManager</span>.shared.sdkInitialize(appID: appID, appSecret: secret)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>仅做<em>分享</em>功能的话, <figure class="highlight plain"><figcaption><span>字段无用.</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">初始化内部实现略微有区别:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Objective-C:</span><br><span class="line"></span><br><span class="line">```objc</span><br><span class="line">UInt64 typeFlag = MMAPP_SUPPORT_TEXT | MMAPP_SUPPORT_PICTURE | MMAPP_SUPPORT_VIDEO | MMAPP_SUPPORT_LOCATION | MMAPP_SUPPORT_AUDIO | MMAPP_SUPPORT_WEBPAGE; </span><br><span class="line">[WXApi registerAppSupportContentFlag:typeFlag];</span><br><span class="line">[WXApi registerApp:appID];</span><br></pre></td></tr></table></figure></p>
</blockquote>
<blockquote>
<p>Objective-C 中同时设置多个枚举值可以通过 ‘|’ 来实现 option 的设置.</p>
</blockquote>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> typeFlag : <span class="type">TypeFlag</span> = [.<span class="type">Text</span>, .<span class="type">Picture</span>, .<span class="type">Video</span>, .<span class="type">Audio</span>, .<span class="type">Webpage</span>]</span><br><span class="line"><span class="type">WXApi</span>.registerAppSupportContentFlag(typeFlag.rawValue)</span><br><span class="line"><span class="type">WXApi</span>.registerApp(appID)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Swift 中设置多个枚举值不可用 ‘|’ 来实现, 想要达到这样的效果, 必须新建结构体并且实现 <figure class="highlight plain"><figcaption><span>协议, ```OptionSetType``` 改变了 Objective-C 中 ```NS_ENUM``` / ```NS_OPTIONS``` 的行为方式赋予可多选的能力.</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">TypeFlag 的声明(没有写全, 但实际测试并不影响*文件*的分享):</span><br><span class="line"></span><br><span class="line">```swift</span><br><span class="line">private struct TypeFlag : OptionSet &#123;</span><br><span class="line">    </span><br><span class="line">    let rawValue: UInt64</span><br><span class="line">    </span><br><span class="line">    static let Text = TypeFlag(rawValue: enAppSupportContentFlag.MMAPP_SUPPORT_TEXT.rawValue)</span><br><span class="line">    static let Picture = TypeFlag(rawValue: enAppSupportContentFlag.MMAPP_SUPPORT_PICTURE.rawValue)</span><br><span class="line">    static let Video = TypeFlag(rawValue: enAppSupportContentFlag.MMAPP_SUPPORT_VIDEO.rawValue)</span><br><span class="line">    static let Audio = TypeFlag(rawValue: enAppSupportContentFlag.MMAPP_SUPPORT_AUDIO.rawValue)</span><br><span class="line">    static let Webpage = TypeFlag(rawValue: enAppSupportContentFlag.MMAPP_SUPPORT_WEBPAGE.rawValue)</span><br><span class="line">        </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p><strong>b. 分享</strong></p>
<p>微信分享的内容包装同样通过一个 <figure class="highlight plain"><figcaption><span>进行单独处理, 对于文字、网页、图片、视频网链、小程序、文件的分享内容处理都很简单, 特别注意的就是对于音乐链的分享, 同 QQ 一样, 需要区别两个参数, 一个是**音频流**链, 一个是**音频网页**, 播放的是音频流, 点击背景进入的是音频网页.</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Objective-C:</span><br><span class="line"></span><br><span class="line">```objc</span><br><span class="line">WXMusicObject* obj = [WXMusicObject object];</span><br><span class="line">obj.musicDataUrl = musicURL;</span><br><span class="line">obj.musicUrl = webpageURL;</span><br></pre></td></tr></table></figure></p>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = <span class="type">WXMusicObject</span>()</span><br><span class="line">obj.musicUrl = audioStreamURL</span><br><span class="line">obj.musicUrl = webpageURL</span><br></pre></td></tr></table></figure>
<p><strong>文字分享:</strong></p>
<p>Objective-C:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[RWechatManager shared] shareText:text scene: scene completion: completion];</span><br></pre></td></tr></table></figure>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RWechatManager</span>.shared.share(text: shareDescription, scene: scene, completion: shareCompletion)</span><br></pre></td></tr></table></figure>
<p>表现(分享到好友):</p>
<p><img src="media/15302429730401/15348336900423.jpg" alt=""></p>
<p><strong>图片分享:</strong></p>
<p>Objective-C</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[RWechatManager shared] shareImage:targetImage scene: scene completion: completion];</span><br></pre></td></tr></table></figure>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RWechatManager</span>.shared.share(image: targetImage, scene: scene, completion: completion)</span><br></pre></td></tr></table></figure>
<p>表现(分享到好友列表):</p>
<p><img src="media/15302429730401/15348339515124.jpg" alt=""></p>
<p><strong>网页分享:</strong></p>
<p>Objective-C:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[RWechatManager shared] shareWebpageWithURL:webpageURL title:title description:description thumbImage:thumbImage scene: scene completion: completion];</span><br></pre></td></tr></table></figure>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RWechatManager</span>.shared.share(webpageURL: webpageURL, title: title, description: description, thumbImage: thumbImage, scene: scene, completion: completion)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>⚠️ 1. <figure class="highlight plain"><figcaption><span>字段的缩略图大小不能超过 32 Kb, 但实际测试 100 Kb 左右也是完全可行的, 但一定不能过大, 否则会出现:**分享 N 次才能成功一次, 或者干脆无法调起微信的客户端进行分享**.</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&gt; ⚠️ 2. Android  对于缩略图的处理相对友好很多, 对于 iOS 无法分享的过大的缩略图数据一般情况下 Android 都能成功启动微信客户端并且成功分享(亲测).</span><br><span class="line">&gt; ⚠️ 3. 在缩略图没有符合规范的时候, 即使成功分享在 iOS 端也会出现**缩略图不显示**的情况, Android 几乎都会显示.</span><br><span class="line"></span><br><span class="line">表现(分享到好友):</span><br><span class="line">![](media/15302429730401/15348344435248.jpg)</span><br><span class="line"></span><br><span class="line">**视频链分享:**</span><br><span class="line">实质就是网页的分享, 在此不作代码示例.</span><br><span class="line"></span><br><span class="line">**音频链分享:**</span><br><span class="line"></span><br><span class="line">Objective-C:</span><br><span class="line"></span><br><span class="line">```objc</span><br><span class="line">[[RWechatManager shared] shareMusicWithStreamURL: audioStreamURL webpageURL:audioWebpageURL title: title description: description thumbImage:image scene:scene completion: completion];</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RWechatManager</span>.shared.share(audioStreamURL: audioStreamURL, webpageURL: audioWebpageURL, title: title, description: description, thumbImage: thumbImage, scene: scene, completion: completion)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>⚠️ 注意 <figure class="highlight plain"><figcaption><span>和 ```webpageURL``` 的区别, 前面有提及.</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">表现(分享到微信好友):</span><br><span class="line">![](media/15302429730401/15348348506904.jpg)</span><br><span class="line"></span><br><span class="line">**小程序分享:**</span><br><span class="line"></span><br><span class="line">Objective-C:</span><br><span class="line"></span><br><span class="line">```objc</span><br><span class="line">[[RWechatManager shared] shareMiniProgramWithUserName:userName path:path type:type webpageURL:webpageURL title:title description:description thumbImage:image scene: scene completion: completion];</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RWechatManager</span>.shared.shareMiniProgram(userName: userName, path: path, type: type, webpageURL: webpageURL, title: title, description: description, thumbImage: thumbImage, scene: scene, completion: completion)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>⚠️ 1. demo 中笔者并没有编写小程序, 仅仅依照微信的 SDK 进行了参数的设置, 所以无法分享, 但具体的参数设置形式在 demo 中明确标明.<br>⚠️ 2. 小程序分三种类型, <figure class="highlight plain"><figcaption><span>字段分: **发布**、**预览**以及**体验**三个版本.</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**文件分享:**</span><br><span class="line"></span><br><span class="line">Objective-C:</span><br><span class="line"></span><br><span class="line">```objc</span><br><span class="line">[[RWechatManager shared] shareFileWithData:fileData extension:fileExtensionName title:title thumbImage:image scene:scene completion: completion];</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RWechatManager</span>.shared.share(fileData: fileData, extensionName: fileExtensionName, title: title, thumbImage: thumbImage, scene: scene, completion: completion)</span><br></pre></td></tr></table></figure>
<p>对于体积稍大的图片、小体积视频、doc 文本、PDF 文件 都测试过, 可以正常分享, 且通过微信内部的解析可以显示.</p>
<blockquote>
<p>⚠️ 1. 必须设置文件的<strong>扩展名</strong>.<br>⚠️ 2. 文件分享<strong>不支持分享到朋友圈</strong>.<br>⚠️ 3. 在设置<strong>缩略图</strong>的情况下, iOS 端的对话框是不显示缩略图的, 但是 Android<br> 可以, 但也仅限于发送方能看见.</p>
</blockquote>
<p>表现(分享视频到微信好友):<br><img src="media/15302429730401/15348363450963.jpg" alt=""><br><img src="media/15302429730401/15348363567791.jpg" alt=""></p>
<p><strong>c. 返回本应用</strong></p>
<p>Objective-C:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[RWechatManager shared] application:app openURL:url options:options];</span><br></pre></td></tr></table></figure>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RWechatManager</span>.application(app, <span class="keyword">open</span>: url, options : options)</span><br></pre></td></tr></table></figure>
<h4 id="3-3-新浪"><a href="#3-3-新浪" class="headerlink" title="3.3 新浪"></a>3.3 新浪</h4><h5 id="3-3-1-准备"><a href="#3-3-1-准备" class="headerlink" title="3.3.1 准备"></a>3.3.1 准备</h5><p>分享需要注册平台, <a href="http://open.weibo.com/" target="_blank" rel="noopener">新浪开放平台</a>, <a href="http://open.weibo.com/wiki/SDK#iOS_SDK" target="_blank" rel="noopener">SDK 下载</a>, 新浪 SDK <strong>支持 pod 安装</strong>, <a href="https://github.com/sinaweibosdk/weibo_ios_sdk" target="_blank" rel="noopener">iOS 接口调用文档</a>.</p>
<h5 id="3-3-2-集成"><a href="#3-3-2-集成" class="headerlink" title="3.3.2 集成"></a>3.3.2 集成</h5><p>a. 手动导入 <figure class="highlight plain"><figcaption><span>```WBHttpRequest.h```、```libWeiboSDK.a``` 和 ```WeiboSDK.bundle``` 到项目中.</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">pod 集成: pod &quot;Weibo_SDK&quot;, :git =&gt; &quot;https://github.com/sinaweibosdk/weibo_ios_sdk.git&quot; (未实际测试过).</span><br><span class="line"></span><br><span class="line">b. 添加系统依赖```QuartzCore.framework```、```SystemConfiguration.framework```、```ImageIO.framework```、```CoreGraphic.framework```、```Security.framework```、```libsqilte3.0.tbd```、```CoreTelephony.framework```、```CoreText.framework```、```libz.tbd```.</span><br><span class="line">c. 设置 **The Other Flags** 为 **-ObjC**.</span><br><span class="line">d. 在```info.plist```文件的```CFBundleURLTypes```中添加:</span><br><span class="line"></span><br><span class="line">```objc</span><br><span class="line">&lt;key&gt;CFBundleURLSchemes&lt;/key&gt;</span><br><span class="line">&lt;array&gt;</span><br><span class="line">    &lt;string&gt;wbYOURAPPKEY&lt;/string&gt;</span><br><span class="line">&lt;/array&gt;</span><br></pre></td></tr></table></figure></p>
<p>e.对传输安全的支持, 在当下的 iOS 系统中，默认需要为每次网络传输建立 <strong>SSL</strong>, 所以需在 plist 中设置 <strong>NSAppTransportSecurity 的 NSAllowsArbitraryLoads</strong> 为 <strong>YES</strong>.</p>
<p>f. 解除原有 <strong>ATS</strong>设置在 iOS 10+ 的网络限制:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;key&gt;sina.com.cn&lt;/key&gt;</span><br><span class="line">  	&lt;dict&gt;</span><br><span class="line">  		&lt;key&gt;NSIncludesSubdomains&lt;/key&gt;</span><br><span class="line">  		&lt;<span class="literal">true</span>/&gt;</span><br><span class="line">  		&lt;key&gt;NSThirdPartyExceptionAllowsInsecureHTTPLoads&lt;/key&gt;</span><br><span class="line">  		&lt;<span class="literal">true</span>/&gt;</span><br><span class="line">  		&lt;key&gt;NSExceptionMinimumTLSVersion&lt;/key&gt;</span><br><span class="line">  		&lt;string&gt;TLSv1.0&lt;/string&gt;</span><br><span class="line">  		&lt;key&gt;NSThirdPartyExceptionRequiresForwardSecrecy&lt;/key&gt;</span><br><span class="line">  		&lt;<span class="literal">false</span>/&gt;</span><br><span class="line">  	&lt;/dict&gt;</span><br></pre></td></tr></table></figure>
<p>g. 添加以下至白名单:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;string&gt;sinaweibohd&lt;/string&gt;</span><br><span class="line">&lt;string&gt;sinaweibo&lt;/string&gt;</span><br><span class="line">&lt;string&gt;weibosdk&lt;/string&gt;</span><br><span class="line">&lt;string&gt;weibosdk2.5&lt;/string&gt;</span><br></pre></td></tr></table></figure>
<p>h. Swift 语言集成需要 <strong>Objective-C - Swift 桥接文件</strong>.</p>
<h5 id="3-3-3-接口调用及内部实现"><a href="#3-3-3-接口调用及内部实现" class="headerlink" title="3.3.3 接口调用及内部实现"></a>3.3.3 接口调用及内部实现</h5><p><strong>a. 初始化 SDK</strong></p>
<p>Objective-C:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[RSinaWeiboManager shared] sdkInitializeByAppKey:YourAppKey appSecret:YourAppSecret];</span><br></pre></td></tr></table></figure>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RSinaWeiboManager</span>.shared.sdkInitialize(appKey: <span class="type">YourAppKey</span>, appSecret: <span class="type">YourAppSecret</span>)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>仅做<em>分享</em>的话, <figure class="highlight plain"><figcaption><span>字段无用.</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**b. 分享**</span><br><span class="line"></span><br><span class="line">对于分享内容的包装新浪处理的比 QQ 简练, 所以无需借助新的类去处理分享内容, 文字是最简单的, 不需要对文字内容进行二次包装, 直接对 ```WBMessageObject``` 进行文字设置然后发送分享请求即可; </span><br><span class="line"></span><br><span class="line">图片和视频(包括到「微博故事」)的分享需要 ```WBImageObject``` 和 ```WBNewVideoObject``` 的包装, 执行 ```addImages``` 和 ```addVideo``` 方法将要分享的图片/视频处理, 在此需要注意的是:**实例化 ```WBImageObject``` 和 ```WBNewVideoObject``` 的时候必须设置 delegate, 并实现 ```WBMediaTransferProtocol``` 协议, 由于 ```addImages``` 和 ```addVideo``` 是异步操作, 所以 ```wbsdk_TransferDidReceiveObject``` 回调中发送分享请求!**</span><br><span class="line"></span><br><span class="line">另, 经测试, 在参数准备失败的回调函数 ```wbsdk_TransferDidFailWithErrorCode``` 中, 出现的错误场景总结:</span><br><span class="line">&gt; - 图片、视频体积过大;</span><br><span class="line">&gt; - 图片数量不在 1 ~ 9 范围内;</span><br><span class="line">&gt; - 倘若分享到「微博故事」, 照片只能分享一张, 而传了多张图片;</span><br><span class="line">&gt; - ```WBImageObject``` 多参数并存: 单张的 Data 格式的图片和图片数组共存;</span><br><span class="line">&gt; - 视频 URL 错误.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**文字分享:**</span><br><span class="line"></span><br><span class="line">Objective-C:</span><br><span class="line"></span><br><span class="line">```objc</span><br><span class="line">[[RSinaWeiboManager shared] shareText: text completion: completion];</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RSinaWeiboManager</span>.shared.share(text: text, completion: completion)</span><br></pre></td></tr></table></figure>
<p>表现:<br><img src="media/15302429730401/15348443067160.jpg" alt=""></p>
<p><strong>图片分享:</strong></p>
<p>Objective-C:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[RSinaWeiboManager shared] shareImage:images text: text toStory: yesOrNo completion: completion];</span><br></pre></td></tr></table></figure>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RSinaWeiboManager</span>.shared.share(images: images, text: text, isToStory: trueOrFalse, completion: completion)</span><br></pre></td></tr></table></figure>
<p>为统一接口, 图片用数组包装; 分享到「微博故事」功能中 <figure class="highlight plain"><figcaption><span>字段会失效.</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&gt; ⚠️ 1. 开启「分享到微博故事」功能图片只能传一张; 多张图片分享的情况下「分享到微博故事」的功能必须关闭!</span><br><span class="line">&gt; ⚠️ 2. 图片单张不能超过 10 MB, 最多 9 张图片.</span><br><span class="line"></span><br><span class="line">表现:</span><br><span class="line">分享到微博:</span><br><span class="line">![](media/15302429730401/15348430162017.jpg)</span><br><span class="line"></span><br><span class="line">分享到「微博故事」:</span><br><span class="line"></span><br><span class="line">![](media/15302429730401/15348432123235.jpg)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**本地视频分享:**</span><br><span class="line"></span><br><span class="line">Objective-C:</span><br><span class="line"></span><br><span class="line">```objc</span><br><span class="line">[[RSinaWeiboManager shared] shareVideoWithLocalURL:videoFileURL text:text toStory:YesOrNo completion: completion];</span><br></pre></td></tr></table></figure></p>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RSinaWeiboManager</span>.shared.share(localVideoURL: videoFileURL, text: text, isToStory: trueOrFalse, completion: completion)</span><br></pre></td></tr></table></figure>
<p>分享到「微博故事」功能中 <figure class="highlight plain"><figcaption><span>字段会失效.</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&gt; ⚠️ 本地视频 URL 为通过 ```UIImagePickerController``` 选择的媒体 **info** 的 ```UIImagePickerControllerMediaURL``` 的值:</span><br><span class="line">&gt;Objective-C:</span><br><span class="line">&gt;</span><br><span class="line">&gt; ```objc</span><br><span class="line">&gt; videoURL = [info objectForKey:UIImagePickerControllerMediaURL];</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; videoURL = info[<span class="type">UIImagePickerControllerMediaURL</span>]</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p><strong>形如: file:///private/var/mobile/Containers/Data/Application/3B368706-001D-4018-901B-284D64FA50E2/tmp/17BD98B4-A498-46E7-9715-6F39E73DFD75.MOV</strong></p>
</blockquote>
<p>表现:<br>分享到微博:<br><img src="media/15302429730401/15348439011768.jpg" alt=""></p>
<p>分享到「微博故事」:</p>
<p><img src="media/15302429730401/15348440110029.jpg" alt=""></p>
<p><strong>网页分享:</strong></p>
<p>Objective-C:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[RSinaWeiboManager shared] shareWebpageWithURL: webpageURL objectID: <span class="string">@"id"</span> title: title description: description thumbImage:thumbImage completion: completion];</span><br></pre></td></tr></table></figure>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RSinaWeiboManager</span>.shared.share(webpageURL: webpageURL, objectID: <span class="string">"id"</span>, title: title, description: description, thumbImage: thumbImage, completion: completion)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><figcaption><span>字段用于表示一个多媒体内容; 网页的消息体设置无需设置 **delegate**, 因为不涉及异步操作, 而且 ```thumbImage``` 字段应该是失效的, 即不显示缩略图.</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&gt; ⚠️ 1. 网页 ```thumbImage``` 字段的缩略图数据不能大于 32 Kb **(新浪的 SDK 控制的很严格)**.</span><br><span class="line">&gt; ⚠️ 2. ```WBWebpageObject``` 的 ```description``` 设置无效, 想要显示网页的相关描述, 只能设置 ```WBMessageObject``` 的 ```text``` 字段.</span><br><span class="line"></span><br><span class="line">表现: </span><br><span class="line">![](media/15302429730401/15348455830836.jpg)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**c. 返回本应用**</span><br><span class="line"></span><br><span class="line">Objective-C:</span><br><span class="line"></span><br><span class="line">```objc</span><br><span class="line">[[RSinaWeiboManager shared] application:app openURL:url options:options];</span><br></pre></td></tr></table></figure>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RSinaWeiboManager</span>.application(app, <span class="keyword">open</span>: url, options : options)</span><br></pre></td></tr></table></figure>
<h4 id="3-4-Facebook"><a href="#3-4-Facebook" class="headerlink" title="3.4 Facebook"></a>3.4 Facebook</h4><h5 id="3-4-1-准备"><a href="#3-4-1-准备" class="headerlink" title="3.4.1 准备"></a>3.4.1 准备</h5><p>分享需要注册平台, <a href="https://developers.facebook.com/" target="_blank" rel="noopener">Facebook 开发者主页</a>, Facebook SDK <strong>支持 pod 集成</strong>, <a href="https://developers.facebook.com/docs/sharing/ios" target="_blank" rel="noopener">分享接口调用说明</a>.</p>
<h5 id="3-4-2-集成"><a href="#3-4-2-集成" class="headerlink" title="3.4.2 集成"></a>3.4.2 集成</h5><p>a. pod 集成: <figure class="highlight plain"><figcaption><span>'FBSDKLoginKit'```</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">b. 在```info.plist```文件的```CFBundleURLTypes```中添加:</span><br><span class="line"></span><br><span class="line">```objc</span><br><span class="line">&lt;key&gt;CFBundleURLSchemes&lt;/key&gt;</span><br><span class="line">&lt;array&gt;</span><br><span class="line">    &lt;string&gt;fbYOURAPPID&lt;/string&gt;</span><br><span class="line">&lt;/array&gt;</span><br><span class="line">&lt;key&gt;FacebookAppID&lt;/key&gt;</span><br><span class="line">&lt;string&gt;YOURAPPID&lt;/string&gt;</span><br><span class="line">&lt;key&gt;FacebookDisplayName&lt;/key&gt;</span><br><span class="line">&lt;string&gt;SOMENAME&lt;/string&gt;</span><br></pre></td></tr></table></figure></p>
<p>c. 添加以下至白名单:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;string&gt;fbapi&lt;/string&gt;</span><br><span class="line">&lt;string&gt;fb-messenger-share-api&lt;/string&gt;</span><br><span class="line">&lt;string&gt;fbauth2&lt;/string&gt;</span><br><span class="line">&lt;string&gt;fbshareextension&lt;/string&gt;</span><br></pre></td></tr></table></figure>
<p>d. Swift 语言集成需要 <strong>Objective-C - Swift 桥接文件</strong>.</p>
<h5 id="3-4-3-接口调用及内部实现"><a href="#3-4-3-接口调用及内部实现" class="headerlink" title="3.4.3 接口调用及内部实现"></a>3.4.3 接口调用及内部实现</h5><p><strong>a. 初始化 SDK</strong></p>
<p>Objective-C:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[RFacebookManager shared] sdkInitializeByID:appID secret:secret];</span><br></pre></td></tr></table></figure>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RFacebookManager</span>.shared.sdkInitialize(appID: appID, secret: secret)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>仅做<em>分享</em>功能的话, <figure class="highlight plain"><figcaption><span>字段无用.</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**b. 分享**</span><br><span class="line">参数的包装, 借助工具类 ```RFacebookHelper``` 来处理, Facebook 已经封装好了各个类型的分享内容载体 (FBSDKSharePhotoContent、FBSDKShareVideoContent ...), 对应设置属性值就可以; 对于图片的分享, 和新浪的图片分享思路相同, 即: 无论是单张还是多图, 一概通过数组包装传递给 ```RFacebookHelper```, 然后它自行处理.</span><br><span class="line"></span><br><span class="line">**网页分享:**</span><br><span class="line">Objective-C:</span><br><span class="line"></span><br><span class="line">```objc</span><br><span class="line">[[RFacebookManager shared] shareWebpageWithURL: webpageURL</span><br><span class="line">                           quote: quote</span><br><span class="line">                         hashTag: hashTag</span><br><span class="line">                            from: context</span><br><span class="line">                            mode: mode</span><br><span class="line">                      completion: completion];</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RFacebookManager</span>.shared.share(webpageURL: webpageURL, quote: quote, hashTag: hashTag, from: context, mode: mode, completion: completion)</span><br></pre></td></tr></table></figure>
<p>Facebook 的 SDK 在迭代的过程中, 舍弃了很多字段, 分享参数不如新浪那样多样, 但是其分享的表现形式却比国内的要友好很多, 特别是在网页分享这块体现的更加明显, 值得注意的是, <strong>非网页形式的分享回调无效</strong>, 努力地在 <strong>Github</strong>、<strong>Stack Overflow</strong> 和 <strong>Facebook Developer 论坛</strong>找答案但都没有找到解决办法, 根据 <figure class="highlight plain"><figcaption><span>的判断分享结果状态的方法早已失效, 无论是 Android 还是 iOS 端, 目前都没办法.</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&gt; ⚠️ ```hashTag (话题)``` 的表现形式不同于国内, 新浪的话题格式: **#话题#**, 两个 **#** 之间一切内容都能成为话题, 而 Twitter、Instagram、Facebook 的格式: **#话题**, 话题内容词组之间不能有任何富符号且必须连在一起.</span><br><span class="line"></span><br><span class="line">表现:</span><br><span class="line">客户端形式的分享(无回调):</span><br><span class="line">![](media/15302429730401/15349211093796.jpg)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">由上图可见, 在通过客户端分享的过程中, ```quote``` 字段已经丢失, **Android 表现不同, ```quote``` 保留, 其次, iOS 是跳转到 Facebook 客户端分享, Android 是在本应用内弹出对话框分享, 且 Android 通过客户端分享需要提前打开 Facebook 客户端, 否则无法弹出分享对话框, 测试过美图秀秀的图片分享, 也是一样, 需要提前打开客户端.**  </span><br><span class="line"></span><br><span class="line">网页形式的分享(有回调):</span><br><span class="line"></span><br><span class="line">![](media/15302429730401/15349215431611.jpg)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**图片分享:**</span><br><span class="line"></span><br><span class="line">Objective-C:</span><br><span class="line"></span><br><span class="line">```objc</span><br><span class="line">[[RFacebookManager shared] sharePhotos: targetImageArray</span><br><span class="line">                    from:context</span><br><span class="line">              completion: completion];</span><br></pre></td></tr></table></figure></p>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RFacebookManager</span>.shared.share(photos: targetImageArray, from: context, completion: completion)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>⚠️ 1. 照片大小必须小于 12MB.<br>⚠️ 2. 用户需要安装版本 7.0 或以上的原生 iOS 版 Facebook 应用.</p>
</blockquote>
<p>表现:</p>
<p><img src="media/15302429730401/15349284763521.jpg" alt=""></p>
<p><strong>本地视频分享:</strong></p>
<p>Objective-C:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[RFacebookManager shared] shareVideoWithLocalURL: videoURL from: context];</span><br></pre></td></tr></table></figure>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RFacebookManager</span>.shared.share(localVideoURL: videoURL, from: context)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>⚠️  本地视频 URL 为通过 <figure class="highlight plain"><figcaption><span>选择的媒体 **info** 的 ```UIImagePickerControllerReferenceURL``` 的值:</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;Objective-C:</span><br><span class="line">&gt;</span><br><span class="line">&gt; ```objc</span><br><span class="line">&gt; videoURL = [info objectForKey:UIImagePickerControllerReferenceURL];</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<blockquote>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; videoURL = info[<span class="type">UIImagePickerControllerReferenceURL</span>]</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p><strong>形如: assets-library://asset/asset.MP4?id=8FF2F03F-DD84-41A5-A20C-B745E793C0DC&amp;ext=MP4</strong></p>
</blockquote>
<p>倘若通过 Facebook 的 SDK <strong>自行</strong>构建本地视频分享模型, 需注意 iOS 11 前后的模型属性设置不同:<br>Objective-C:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)imagePickerController:(<span class="built_in">UIImagePickerController</span> *)picker</span><br><span class="line">didFinishPickingMediaWithInfo:(<span class="built_in">NSDictionary</span> *)info</span><br><span class="line">&#123;</span><br><span class="line">  FBSDKShareVideo *video = [[FBSDKShareVideo alloc] init];</span><br><span class="line">  <span class="keyword">if</span> (@available(iOS <span class="number">11</span>, *)) &#123;</span><br><span class="line">    video.videoAsset = [info objectForKey:<span class="built_in">UIImagePickerControllerPHAsset</span>];</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    video.videoURL = [info objectForKey:<span class="built_in">UIImagePickerControllerReferenceURL</span>];</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">imagePickerController</span><span class="params">(<span class="number">_</span> picker: UIImagePickerController, didFinishPickingMediaWithInfo info: [String : Any])</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> video = <span class="type">FBSDKShareVideo</span>()</span><br><span class="line">    <span class="keyword">if</span> #available(iOS <span class="number">11</span>, *) &#123;</span><br><span class="line">        video.videoAsset = info[<span class="type">UIImagePickerControllerPHAsset</span>]     </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        video.videoURL = info[<span class="type">UIImagePickerControllerReferenceURL</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>为了统一使用 URL 分享本地视频, 所以我并没有考虑使用上述的写法.</p>
<p>表现:</p>
<p><img src="media/15302429730401/15350068215466.jpg" alt=""></p>
<p><strong>C. 返回本应用</strong></p>
<p>Objective-C：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[RFacebookManager shared]application:app openURL:url options:options];</span><br></pre></td></tr></table></figure>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RFacebookManager</span>.application(app, <span class="keyword">open</span>: url, options : options)</span><br></pre></td></tr></table></figure>
<p><strong>d. 其他设置</strong></p>
<p>在完成 Facebook 登录、分享等操作的时候还需要连接本应用的 <figure class="highlight plain"><figcaption><span>, 故在 ```didFinishLaunchingWithOptions``` 函数中添加:</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Objective-C:</span><br><span class="line"></span><br><span class="line">```objc</span><br><span class="line">[[RFacebookManager shared] application:application didFinishLaunchingWithOptions:launchOptions];</span><br></pre></td></tr></table></figure></p>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RFacebookManager</span>.shared.application(application, didFinishLaunchingWithOptions: launchOptions)</span><br></pre></td></tr></table></figure>
<p>当需要记录有多少用户激活的时候需要在 <figure class="highlight plain"><figcaption><span>方法中添加:</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Objective-C:</span><br><span class="line"></span><br><span class="line">```objc</span><br><span class="line">[[RFacebookManager shared]applicationDidBecomeActive:application];</span><br></pre></td></tr></table></figure></p>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RFacebookManager</span>.shared.applicationDidBecomeActive(application)</span><br></pre></td></tr></table></figure>
<h4 id="3-5-Twitter"><a href="#3-5-Twitter" class="headerlink" title="3.5 Twitter"></a>3.5 Twitter</h4><h5 id="3-5-1-准备"><a href="#3-5-1-准备" class="headerlink" title="3.5.1 准备"></a>3.5.1 准备</h5><p>分享需要注册平台, <a href="https://developer.twitter.com/content/developer-twitter/en.html" target="_blank" rel="noopener">Twitter 开发者主页</a>, <a href="https://apps.twitter.com/" target="_blank" rel="noopener">注册应用主页</a>, Twitter SDK <strong>支持 pod 集成</strong>, <a href="https://github.com/twitter/twitter-kit-ios/wiki/Compose-Tweets" target="_blank" rel="noopener">分享接口调用说明</a>.</p>
<p><strong>⚠️: Twitter SDK 将于 2018/10/31 后不再进行维护, 但是不影响后续使用, 需自行维护, <a href="https://blog.twitter.com/developer/en_us/topics/tools/2018/discontinuing-support-for-twitter-kit-sdk.html" target="_blank" rel="noopener">Twitter 产品经理 Neil Shah 对 Twitter SDK 放弃维护迭代的声明博客</a>.</strong></p>
<h5 id="3-5-2-集成"><a href="#3-5-2-集成" class="headerlink" title="3.5.2 集成"></a>3.5.2 集成</h5><p>a. pod 集成: <figure class="highlight plain"><figcaption><span>'TwitterKit'```</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">b. 在```info.plist```文件的```CFBundleURLTypes```中添加:</span><br><span class="line"></span><br><span class="line">```objc</span><br><span class="line">&lt;key&gt;CFBundleURLSchemes&lt;/key&gt;</span><br><span class="line">&lt;array&gt;</span><br><span class="line">    &lt;string&gt;twitterkit-YOURCONSUMERKEY&lt;/string&gt;</span><br><span class="line">&lt;/array&gt;</span><br></pre></td></tr></table></figure></p>
<p>c. 添加以下至白名单:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;string&gt;twitter&lt;/string&gt;</span><br><span class="line">&lt;string&gt;twitterauth&lt;/string&gt;</span><br></pre></td></tr></table></figure>
<p>d. Swift 语言集成需要 <strong>Objective-C - Swift 桥接文件</strong>.</p>
<h5 id="3-5-3-接口调用及内部实现"><a href="#3-5-3-接口调用及内部实现" class="headerlink" title="3.5.3 接口调用及内部实现"></a>3.5.3 接口调用及内部实现</h5><p><strong>a. 初始化 SDK</strong></p>
<p>Objective-C:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[RTwitterManager shared] sdkInitializeByConsumerKey:yourConsumerKey consumerSecret:yourConsumerSecret];</span><br></pre></td></tr></table></figure>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RTwitterManager</span>.shared.sdkInitialize(consumerKey: consumerKey, consumerSecret: secret)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>仅做<em>分享</em>的话, <figure class="highlight plain"><figcaption><span>字段无用.</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">**b. 授权 Twitter 客户端**</span><br><span class="line">与其他平台分享不同的是, Twitter 在进行发推(分享)的时候会先进行检测本地的 ```SessionStore``` 的标记判断是否登录(授权)过, 所以在进行发推的时候需要进行这一步的判断, 在未登录的情况下需进行授权, 在此使用 ```RTwitterAuthHelper``` 进行处理, 登录(授权回调):</span><br><span class="line"></span><br><span class="line">Objective-C:</span><br><span class="line"></span><br><span class="line">```objc</span><br><span class="line">typedef void (^auth)(RTWAuthState state, NSString* _Nullable errorInfo);</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p>Swfit:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typealias</span> <span class="type">RTWAuthCompletion</span> = (<span class="number">_</span> state : <span class="type">RTWAuthState</span>,<span class="number">_</span> errorInfo : <span class="type">String</span>?) -&gt; <span class="type">Void</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><figcaption><span>包括成功和失败两种结果.</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**判断是否登录过:**</span><br><span class="line"></span><br><span class="line">Objective-C:</span><br><span class="line"></span><br><span class="line">```objc</span><br><span class="line">BOOL flag = [[RTwitterAuthHepler shared] hasLogged];</span><br></pre></td></tr></table></figure>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="number">_</span> = <span class="type">RTwitterAuthHepler</span>.shared.hasLogged</span><br></pre></td></tr></table></figure>
<p><strong>登录授权:</strong></p>
<p>Objective-C:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[[RTwitterAuthHelper shared]authorizeTwitter:^(RTWAuthState state, <span class="built_in">NSString</span> * _Nullable errorInfo) &#123;</span><br><span class="line">    <span class="comment">// some code ...</span></span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RTwitterAuthHepler</span>.shared.authorizeTwitter &#123; (state, errorInfo) <span class="keyword">in</span></span><br><span class="line">    <span class="comment">// some code ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这一步**目前的情况就是把 Twitter SDK 提供的授权方法重新包装写了遍, 但是考虑到未来可能用到 <figure class="highlight plain"><figcaption><span>和 ```token``` 等信息并处理, 所以单独写了类讲授权和分享隔离.**</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**返回本应用:**</span><br><span class="line"></span><br><span class="line">Twitter 分享是不需要进行程序跳转的, 只有在登录授权的时候才会需要下述方法, 所以当你成功授权了以后卸载掉 Twitter 的客户端依然可以进行分享.</span><br><span class="line"></span><br><span class="line">Objective-C:</span><br><span class="line"></span><br><span class="line">```objc</span><br><span class="line">[[RTwitterManager shared] application:app openURL:url options:options];</span><br></pre></td></tr></table></figure></p>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RTwitterManager</span>.application(app, <span class="keyword">open</span>: url, options : options)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>⚠️ Twitter 最新 SDK 要求项目的  <figure class="highlight plain"><figcaption><span>Target``` 至少为 **9.0**.</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**c. 分享**</span><br><span class="line"></span><br><span class="line">在本人写的 demo 中, *分享*和*登录授权*是衔接的, 即: 若未登录过 -&gt; 登录授权 -&gt; 分享.</span><br><span class="line">另, Twitter 能分享的内容相对较少, 所以关于**文字、网页、图片**的分享, 统一到一个分享接口里, 三者不能同时为空.</span><br><span class="line"></span><br><span class="line">表现:</span><br><span class="line">![](media/15302429730401/15353385848004.jpg)</span><br><span class="line"></span><br><span class="line">Twitter 分享是在本应用内弹出分享框进行分享.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### 3.6 Instagram</span><br><span class="line">##### 3.6.1 准备</span><br><span class="line"></span><br><span class="line">分享无需注册平台无需 SDK, [Instagram 开发者主页](https://www.instagram.com/developer/), [Custom URL Scheme 方式分享](https://www.instagram.com/developer/mobile-sharing/iphone-hooks/).</span><br><span class="line"></span><br><span class="line">##### 3.6.2 配置</span><br><span class="line"></span><br><span class="line">在```info.plist```文件中:</span><br><span class="line">添加以下至白名单:</span><br><span class="line"></span><br><span class="line">```objc</span><br><span class="line">&lt;string&gt;instagram&lt;/string&gt;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h5 id="3-6-3-接口调用及内部实现"><a href="#3-6-3-接口调用及内部实现" class="headerlink" title="3.6.3 接口调用及内部实现"></a>3.6.3 接口调用及内部实现</h5><p><strong>分享</strong></p>
<p>无论照片还是视频都是通过 <strong>Custom URL Scheme</strong> 来打开 Instagram 客户端, 但 demo 中实际的方法和 <a href="https://www.instagram.com/developer/mobile-sharing/iphone-hooks/" target="_blank" rel="noopener">Instagram 提供的 Custom URL</a>不同.</p>
<p>Objective-C:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="built_in">NSURL</span>* instagramLibraryURL() &#123;</span><br><span class="line">    <span class="built_in">NSString</span> *str = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"instagram://library?AssetPath=%@"</span>, <span class="string">@""</span>];</span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">NSURL</span> URLWithString:str];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fileprivate</span> <span class="keyword">let</span> instagramURL = <span class="type">URL</span>(string: <span class="type">String</span>(format: <span class="string">"instagram://library?AssetPath=%@"</span>, <span class="string">""</span> <span class="keyword">as</span> <span class="type">CVarArg</span>))</span><br></pre></td></tr></table></figure>
<p>分享流程是<strong>先保存</strong>照片/视频再分享.<br>保存照片:</p>
<p>Objective-C</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UIImageWriteToSavedPhotosAlbum</span>(image, <span class="keyword">self</span>, <span class="keyword">@selector</span>(image:didFinishSavingWithError:contextInfo:), (__bridge <span class="keyword">void</span> *)<span class="keyword">self</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)image:(<span class="built_in">UIImage</span> *)image didFinishSavingWithError:(<span class="built_in">NSError</span> *)error contextInfo:(<span class="keyword">void</span> *)contextInfo</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> ([[<span class="built_in">UIApplication</span> sharedApplication] canOpenURL:instagramLibraryURL()]) &#123;</span><br><span class="line">        [[<span class="built_in">UIApplication</span> sharedApplication] openURL:instagramLibraryURL()];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">UISaveVideoAtPathToSavedPhotosAlbum</span>(localVideoURL.path, <span class="keyword">self</span>, #selector(video(path:didFinishSavingWithError:contextInfo:)), <span class="literal">nil</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@objc</span> <span class="keyword">fileprivate</span> <span class="function"><span class="keyword">func</span> <span class="title">image</span><span class="params">(image: UIImage!, didFinishSavingWithError error: NSError!, contextInfo: AnyObject!)</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="type">UIApplication</span>.shared.canOpenURL(instagramURL!) &#123;</span><br><span class="line">            <span class="type">UIApplication</span>.shared.openURL(instagramURL!)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>保存视频:</p>
<p>Objective-C:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UISaveVideoAtPathToSavedPhotosAlbum</span>(localeVideoURL.path, <span class="keyword">self</span>, <span class="keyword">@selector</span>(video:didFinishSavingWithError:contextInfo:), <span class="literal">nil</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)video:(<span class="built_in">NSString</span> *)path didFinishSavingWithError:(<span class="built_in">NSError</span> *)error contextInfo:(<span class="keyword">void</span> *)contextInfo &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> ([[<span class="built_in">UIApplication</span> sharedApplication] canOpenURL:instagramLibraryURL()]) &#123;</span><br><span class="line">        [[<span class="built_in">UIApplication</span> sharedApplication] openURL:instagramLibraryURL()];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">UISaveVideoAtPathToSavedPhotosAlbum</span>(localVideoURL.path, <span class="keyword">self</span>, #selector(video(path:didFinishSavingWithError:contextInfo:)), <span class="literal">nil</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@objc</span> <span class="keyword">fileprivate</span> <span class="function"><span class="keyword">func</span> <span class="title">video</span><span class="params">(path: String!, didFinishSavingWithError error: NSError!, contextInfo: AnyObject!)</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="type">UIApplication</span>.shared.canOpenURL(instagramURL!) &#123;</span><br><span class="line">            <span class="type">UIApplication</span>.shared.openURL(instagramURL!)</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>分享图片:</strong></p>
<p>Objective-C:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[RInstagramManager shared] share: targetImage];</span><br></pre></td></tr></table></figure>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RInstagramManager</span>.shared.share(image: targetImage)</span><br></pre></td></tr></table></figure>
<p>表现:<br><img src="media/15302429730401/15353508681576.jpg" alt=""></p>
<p><strong>分享本地视频:</strong></p>
<p>Objective-C:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[RInstagramManager shared]shareVideoWithLocalURL: videoURL description: description]</span><br></pre></td></tr></table></figure>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RInstagramManager</span>.shared.share(localVideoURL: videoFileURL!, description: description)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><figcaption><span>字段在实际传递过程中是失效的.</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&gt;⚠️  本地视频 URL 为通过 ```UIImagePickerController``` 选择的媒体 **info** 的 ```UIImagePickerControllerReferenceURL``` 的值:</span><br><span class="line">&gt;Objective-C:</span><br><span class="line">&gt;</span><br><span class="line">&gt; ```objc</span><br><span class="line">&gt; videoURL = [info objectForKey:UIImagePickerControllerReferenceURL];</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; videoURL = info[<span class="type">UIImagePickerControllerReferenceURL</span>]</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p><strong>形如: assets-library://asset/asset.MP4?id=8FF2F03F-DD84-41A5-A20C-B745E793C0DC&amp;ext=MP4</strong></p>
</blockquote>
<p>表现:<br><img src="media/15302429730401/15354210062698.jpg" alt=""></p>
<h4 id="3-7-Tumblr"><a href="#3-7-Tumblr" class="headerlink" title="3.7 Tumblr"></a>3.7 Tumblr</h4><h5 id="3-7-1-准备"><a href="#3-7-1-准备" class="headerlink" title="3.7.1 准备"></a>3.7.1 准备</h5><p>分享需要注册平台, <a href="https://www.tumblr.com/developers" target="_blank" rel="noopener">Tumblr 开发者主页</a>, <a href="https://dev.flurry.com/admin/applications" target="_blank" rel="noopener">注册应用主页</a>, Tumblr SDK <strong>支持 pod 集成</strong>, <a href="https://developer.yahoo.com/flurry/docs/tumblrsharing/iOS/" target="_blank" rel="noopener">分享接口调用说明</a>.</p>
<h5 id="3-7-2-集成"><a href="#3-7-2-集成" class="headerlink" title="3.7.2 集成"></a>3.7.2 集成</h5><p>a. pod 集成: <figure class="highlight plain"><figcaption><span>'Flurry-iOS-SDK/TumblrAPI'```</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">⚠️: 一定是这个, 最新版本的 SDK 我没有找到分享的接口.</span><br><span class="line"></span><br><span class="line">b. Swift 语言集成需要 **Objective-C - Swift 桥接文件**.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">##### 3.5.3 接口调用及内部实现</span><br><span class="line"></span><br><span class="line">**a. 初始化 SDK**</span><br><span class="line"></span><br><span class="line">Objective-C:</span><br><span class="line"></span><br><span class="line">```objc</span><br><span class="line">[[RTumblrManager shared] sdkInitializeByConsumerKey:yourConsumerKey consumerSecret: yourConsumerSecret];</span><br></pre></td></tr></table></figure></p>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RTumblrManager</span>.shared.sdkInitialize(consumerKey: yourConsumerKey, consumerSecret: yourConsumerSecret)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>⚠️ 在 iOS 端初始化 SDK 需要 <figure class="highlight plain"><figcaption><span>和 ```consumerSecret``` 两个参数, Android 端还需要 ```flurryKey``` 这个参数才能完成分享.</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**b. 分享**</span><br><span class="line"></span><br><span class="line">Tumblr 分享体只包括**图片**和**文字**两种, 并且图片还是网络图片的链接, 并不能分享本地图片, 所以 Tumblr 的局限性很大, 这两种分享体的模型通过 SDK 中 ```FlurryImageShareParameters``` 和 ```FlurryTextShareParameters``` 来构建;</span><br><span class="line">Tumblr 分享是通过当前界面弹出对话框分享的, 和 Twitter 类似, 所以不需要判断 Tumblr 程序是否安装;</span><br><span class="line">Tumblr 的分享流程是: **登录 -&gt; 分享**, 但是登录的逻辑不需要在代码中实现, 他会自动呈现浏览器的登录界面.</span><br><span class="line"></span><br><span class="line">**文字分享:**</span><br><span class="line"></span><br><span class="line">Objective-C:</span><br><span class="line"></span><br><span class="line">```objc</span><br><span class="line">[[RTumblrManager shared] shareText: text title: title webpageURL: webpageURL from: context completion: completion];</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RTumblrManager</span>.shared.share(text: text, title: title, webpageURL: webpageURL, from: context, completion: completion)</span><br></pre></td></tr></table></figure>
<p>表现:<br><img src="media/15302429730401/15354232020858.jpg" alt=""></p>
<p><strong>图片链接分享:</strong></p>
<p>Objective-C:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[RTumblrManager shared] shareImageWithURL: targetImageURL description: description webpageURL: webpageURL from: context completion: completion];</span><br></pre></td></tr></table></figure>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RTumblrManager</span>.shared.share(imageURL: targetImageURL, description: description, webpageURL: webpageURL, from: context, completion: completion)</span><br></pre></td></tr></table></figure>
<p>表现:<br><img src="media/15302429730401/15354229930666.jpg" alt=""></p>
<h4 id="3-8-Pinterest"><a href="#3-8-Pinterest" class="headerlink" title="3.8 Pinterest"></a>3.8 Pinterest</h4><h5 id="3-8-1-准备"><a href="#3-8-1-准备" class="headerlink" title="3.8.1 准备"></a>3.8.1 准备</h5><p>分享需要注册平台, <a href="https://developers.pinterest.com/" target="_blank" rel="noopener">Pinterest 开发者主页</a>, <a href="https://developers.pinterest.com/apps/" target="_blank" rel="noopener">注册应用主页</a>, Pinterest SDK <strong>支持 pod 集成</strong>, <a href="https://developers.pinterest.com/docs/sdks/ios/" target="_blank" rel="noopener">接口调用说明</a>.</p>
<h5 id="3-8-2-集成"><a href="#3-8-2-集成" class="headerlink" title="3.8.2 集成"></a>3.8.2 集成</h5><p>a. pod 集成: <figure class="highlight plain"><figcaption><span>“PinterestSDK”, :git </span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">d. 在```info.plist```文件的```CFBundleURLTypes```中添加:</span><br><span class="line"></span><br><span class="line">```objc</span><br><span class="line">&lt;key&gt;CFBundleURLTypes&lt;/key&gt;</span><br><span class="line">  &lt;array&gt;</span><br><span class="line">    &lt;dict&gt;</span><br><span class="line">      &lt;key&gt;CFBundleURLName&lt;/key&gt;</span><br><span class="line">      &lt;string&gt;&lt;/string&gt;</span><br><span class="line">      &lt;key&gt;CFBundleURLSchemes&lt;/key&gt;</span><br><span class="line">      &lt;array&gt;</span><br><span class="line">        &lt;string&gt;pdkYOURAPPID&lt;/string&gt;</span><br><span class="line">      &lt;/array&gt;</span><br><span class="line">    &lt;/dict&gt;</span><br><span class="line">  &lt;/array&gt;</span><br></pre></td></tr></table></figure></p>
<p>e. 添加以下至白名单:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;string&gt;pinterestsdk.v1&lt;/string&gt;</span><br></pre></td></tr></table></figure>
<p>b. Swift 语言集成需要 <strong>Objective-C - Swift 桥接文件</strong>.</p>
<h5 id="3-8-3-接口调用及内部实现"><a href="#3-8-3-接口调用及内部实现" class="headerlink" title="3.8.3 接口调用及内部实现"></a>3.8.3 接口调用及内部实现</h5><p><strong>a. 初始化 SDK</strong></p>
<p>Objective-C:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[RPinterestManager shared] sdkInitializeByAppID: yourAppID appSecret:yourAppSecret];</span><br></pre></td></tr></table></figure>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RPinterestManager</span>.shared.sdkInitialize(appID: yourAppID, appSecret: yourAppSecret)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>仅做<em>分享</em>功能的话, <figure class="highlight plain"><figcaption><span>字段无用.</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**b. 分享**</span><br><span class="line"></span><br><span class="line">**⚠️: Pinterest 分享要求项目的 CFBundleDisplayName 一定不能为空!!!**</span><br><span class="line"></span><br><span class="line">**图片链接分享:**</span><br><span class="line"></span><br><span class="line">Objective-C:</span><br><span class="line"></span><br><span class="line">```objc</span><br><span class="line">[[RPinterestManager shared] shareImageWithURL: targetImageURL webpageURL: webpageURL onBoard:boardName description: description  from: context completion:completion];</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RPinterestManager</span>.shared.share(imageURL: targetImageURL, webpageURL: webpageURL, boardName: boardName, description: description, from: context, completion: completion)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><figcaption><span>字段即使随便设置也不影响, 考虑到有可能对 Pinterest 功能细化的时候会用到这个字段就保留下来了.</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">表现:</span><br><span class="line"></span><br><span class="line">![](media/15302429730401/15354243444267.jpg)</span><br><span class="line"></span><br><span class="line">**c. 返回本应用**</span><br><span class="line"></span><br><span class="line">Objective-C:</span><br><span class="line"></span><br><span class="line">```objc</span><br><span class="line">[[RPinterestManager shared] application:app openURL:url options:nil];</span><br></pre></td></tr></table></figure>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RPinterestManager</span>.application(app, <span class="keyword">open</span>: url, options : options)</span><br></pre></td></tr></table></figure>
<h4 id="3-9-Line"><a href="#3-9-Line" class="headerlink" title="3.9 Line"></a>3.9 Line</h4><h5 id="3-9-1-准备"><a href="#3-9-1-准备" class="headerlink" title="3.9.1 准备"></a>3.9.1 准备</h5><p>分享无需注册平台.</p>
<h5 id="3-9-2-配置"><a href="#3-9-2-配置" class="headerlink" title="3.9.2 配置"></a>3.9.2 配置</h5><p>在<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">添加以下至白名单:</span><br><span class="line"></span><br><span class="line">```objc</span><br><span class="line">&lt;string&gt;line&lt;/string&gt;</span><br></pre></td></tr></table></figure></p>
<h5 id="3-9-3-接口调用及内部实现"><a href="#3-9-3-接口调用及内部实现" class="headerlink" title="3.9.3 接口调用及内部实现"></a>3.9.3 接口调用及内部实现</h5><p><strong>分享</strong></p>
<p>Line 分享是通过 <strong>Custom URL Scheme</strong> 来打开 Line 客户端进行分享, 但 demo 中实际的方法和 <a href="https://developers.line.me/en/docs/messaging-api/using-line-url-scheme/" target="_blank" rel="noopener">Line 提供的 Custom URL</a>.</p>
<p>文本分享的 URL 为 <figure class="highlight plain"><figcaption><span>要对 ```targetText``` 中的**中文、特殊字符等**进行处理:</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Object-C:</span><br><span class="line"></span><br><span class="line">```objc</span><br><span class="line">[targetText stringByAddingPercentEncodingWithAllowedCharacters:[NSCharacterSet URLQueryAllowedCharacterSet]];</span><br></pre></td></tr></table></figure></p>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">targetText.addingPercentEncoding(withAllowedCharacters: .urlQueryAllowed)</span><br></pre></td></tr></table></figure>
<p>图片分享的 URL 为 <figure class="highlight plain"><figcaption><span>URL 后面的部分可通过 UIPasteboard 实例的 ```name``` 属性拼接:</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Objective-C:</span><br><span class="line"></span><br><span class="line">```objc</span><br><span class="line">UIPasteboard* p = [UIPasteboard generalPasteboard];</span><br><span class="line">[p setData:(UIImageJPEGRepresentation(image, 1)) forPasteboardType:@&quot;public.jpeg&quot;];</span><br><span class="line">NSURL* lineURL = [NSURL URLWithString:[NSString stringWithFormat:@&quot;line://msg/image/%@&quot;,p.name]];</span><br></pre></td></tr></table></figure></p>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> p = <span class="type">UIPasteboard</span>.general</span><br><span class="line">p.setData(<span class="type">UIImageJPEGRepresentation</span>(image, <span class="number">0.1</span>)!, forPasteboardType:<span class="string">"public.jpeg"</span>)</span><br><span class="line"><span class="keyword">let</span> lineURL = <span class="type">URL</span>(string: <span class="type">String</span>(format: lineURLPrefix + <span class="string">"line://msg/image/%@"</span>, p.name <span class="keyword">as</span> <span class="type">CVarArg</span>))</span><br></pre></td></tr></table></figure>
<p><strong>文字分享:</strong></p>
<p>Objective-C:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[RLineManager shared] shareText: text];</span><br></pre></td></tr></table></figure>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RLineManager</span>.shared.share(text: text)</span><br></pre></td></tr></table></figure>
<p>表现:<br><img src="media/15302429730401/15354345270701.jpg" alt=""></p>
<p><strong>图片分享:</strong></p>
<p>Objective-C:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[RLineManager shared] shareImage: targetImage];</span><br></pre></td></tr></table></figure>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RLineManager</span>.shared.share(image: targetImage)</span><br></pre></td></tr></table></figure>
<p>表现:<br><img src="media/15302429730401/15354346583127.jpg" alt=""></p>
<h4 id="3-10-WhatsApp"><a href="#3-10-WhatsApp" class="headerlink" title="3.10 WhatsApp"></a>3.10 WhatsApp</h4><h5 id="3-10-1-准备"><a href="#3-10-1-准备" class="headerlink" title="3.10.1 准备"></a>3.10.1 准备</h5><p>分享无需注册平台.</p>
<h5 id="3-10-2-配置"><a href="#3-10-2-配置" class="headerlink" title="3.10.2 配置"></a>3.10.2 配置</h5><p>在<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">添加以下至白名单:</span><br><span class="line"></span><br><span class="line">```objc</span><br><span class="line">&lt;string&gt;whatsapp&lt;/string</span><br></pre></td></tr></table></figure></p>
<h5 id="3-10-3-接口调用及内部实现"><a href="#3-10-3-接口调用及内部实现" class="headerlink" title="3.10.3 接口调用及内部实现"></a>3.10.3 接口调用及内部实现</h5><p><strong>分享</strong><br>通过 <strong>Custom URL Scheme</strong> 分享文字, 图片是通过 <figure class="highlight plain"><figcaption><span>来实现应用间数据共享, 构建文字的 URL 为 ```whatsapp://send?text</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**文字分享:**</span><br><span class="line"></span><br><span class="line">Objective-C:</span><br><span class="line"></span><br><span class="line">```objc</span><br><span class="line">[[RWhatsAppManager shared]shareText: text]</span><br></pre></td></tr></table></figure></p>
<p>Swift:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RWhatsAppManager.shared.share(text: text)</span><br></pre></td></tr></table></figure>
<p>表现:<br><img src="media/15302429730401/15354355909817.jpg" alt=""></p>
<p><strong>图片分享:</strong></p>
<p>Objective-C:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[RWhatsAppManager shared]shareImage: targetImage from: context];</span><br></pre></td></tr></table></figure>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RWhatsAppManager</span>.shared.share(image: targetImage , from: context)</span><br></pre></td></tr></table></figure>
<p>表现:<br><img src="media/15302429730401/WechatIMG450.jpg" alt="WechatIMG450"></p>
<h4 id="3-11-GooglePlus"><a href="#3-11-GooglePlus" class="headerlink" title="3.11 GooglePlus"></a>3.11 GooglePlus</h4><h5 id="3-11-1-准备"><a href="#3-11-1-准备" class="headerlink" title="3.11.1 准备"></a>3.11.1 准备</h5><p>分享无需注册平台, <a href="https://developers.google.com/+/" target="_blank" rel="noopener">Google Plus 开发者主页</a>已经把 iOS 相关移除了.</p>
<h5 id="3-11-2-接口调用及内部实现"><a href="#3-11-2-接口调用及内部实现" class="headerlink" title="3.11.2 接口调用及内部实现"></a>3.11.2 接口调用及内部实现</h5><p><strong>分享</strong><br>Google Plus 只支持通过 <strong>Custom URL Scheme</strong> 分享网页, 构建 URL 为 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">内部构建:</span><br><span class="line"></span><br><span class="line">Objective-C:</span><br><span class="line"></span><br><span class="line">```objc</span><br><span class="line">NSURLComponents* urlComponents = [[NSURLComponents alloc]</span><br><span class="line">                                      initWithString:@&quot;https://plus.google.com/share&quot;];</span><br><span class="line">urlComponents.queryItems = @[[[NSURLQueryItem alloc]</span><br><span class="line">                                  initWithName:@&quot;url&quot;</span><br><span class="line">                                  value:[shareURL absoluteString]]];</span><br><span class="line">NSURL* url = [urlComponents URL];    </span><br><span class="line">if ([SFSafariViewController class]) &#123;</span><br><span class="line">    SFSafariViewController* controller = [[SFSafariViewController alloc] initWithURL:url];</span><br><span class="line">    controller.delegate = self;</span><br><span class="line">    [from presentViewController:controller animated:YES completion:nil];</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    [[UIApplication sharedApplication] openURL:url];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Swfit:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> components = <span class="type">URLComponents</span>(string: <span class="string">"https://plus.google.com/share"</span>)</span><br><span class="line">components?.queryItems = [<span class="type">URLQueryItem</span>(name: <span class="string">"url"</span>, value: webpageURL.absoluteString)]</span><br><span class="line"><span class="keyword">let</span> url = components?.url</span><br><span class="line"><span class="keyword">if</span> #available(iOS <span class="number">9</span>, *) &#123;</span><br><span class="line">    <span class="keyword">let</span> vc = <span class="type">SFSafariViewController</span>(url: url!)</span><br><span class="line">    vc.delegate = <span class="keyword">self</span></span><br><span class="line">    from.present(vc, animated: <span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="type">UIApplication</span>.shared.openURL(url!)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>网页分享:</strong><br>Objective-C:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[RGooglePlusManager shared]shareURL:[<span class="built_in">NSURL</span> URLWithString: targetURL] from: context];</span><br></pre></td></tr></table></figure>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RGooglePlusManager</span>.shared.share(webpageURL: <span class="type">URL</span>(string: targetURL)!, from: context)</span><br></pre></td></tr></table></figure>
<p>表现:<br><img src="media/15302429730401/15354368096708.jpg" alt=""></p>
<h3 id="4-统一分享接口"><a href="#4-统一分享接口" class="headerlink" title="4 统一分享接口"></a>4 统一分享接口</h3><h5 id="4-1-缺陷"><a href="#4-1-缺陷" class="headerlink" title="4.1 缺陷"></a>4.1 缺陷</h5><p><strong>缺陷说在前面, 其实本来不打算统一接口的.</strong></p>
<ul>
<li>假如只想分享某五个平台, 其余的六个平台仍然不可以删掉, 主分享 Manager 和子平台分享 Manager 存在耦和;</li>
<li>分享接口优化受限制, 由于前面的平台分享对比表格可知, 国外的平台分享很多都没有回调, 而国内的平台分享内容又存在多种形式, 无法实现高度统一;</li>
<li>添加平台没有做<strong>去重处理</strong>, 造成不必要的开销;</li>
<li>分享完毕返回到本应用的统一处理中子平台分享 Manager 和主分享 Manager 存在代码污染. </li>
</ul>
<h5 id="4-2-类图"><a href="#4-2-类图" class="headerlink" title="4.2 类图"></a>4.2 类图</h5><p><img src="media/15302429730401/iOS%20%E5%88%86%E4%BA%AB%E7%BB%9F%E4%B8%80%E6%8E%A5%E5%8F%A3%E7%B1%BB%E5%9B%BE.png" alt="iOS 分享统一接口类图"></p>
<ul>
<li><strong>RShareManger:</strong> 主分享 Manager, 子平台 Manager 的初始化、分享、应用跳转和一些其他操作都在此进行;</li>
<li><strong>RPlatform:</strong> 主要进行应用是否安装、添加目标应用的操作;</li>
<li><strong>RRegister:</strong> 主要进行 <figure class="highlight plain"><figcaption><span>和子平台分享 Manager 的 SDK 初始化衔接;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">- **RImageContent、RVideoContent、RTextContent、RWebpageContent** 为四种对应分享内容模型.</span><br><span class="line"></span><br><span class="line">##### 4.3 详细设计</span><br><span class="line"></span><br><span class="line">- 平台添加</span><br><span class="line"></span><br><span class="line">平台相关都交给 ```RPlatform``` 去处理, 平台的添加借鉴了 Java 中的 **Builder 模式**思路去处理, ```RPlatform``` 的成员属性 ```targets``` 在 Objective-C 中为:</span><br><span class="line"></span><br><span class="line">```objc</span><br><span class="line">@property (strong, nonatomic, readonly) NSArray&lt;Class&gt;* targets;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>Swift 中为:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> targets : <span class="type">Array</span>&lt;<span class="type">RShare</span>.<span class="type">Type</span>&gt; = [] <span class="comment">// 多态的体现</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><figcaption><span>函数为添加平台的操作, 参数为平台枚举 ```RShareSDKPlatform```, ```RPlatform``` 的私有成员属性 ```info``` 为字典类型, key 为平台的字符串形式,  value 平台类型 , 通过 ```add``` 操作的平台枚举去取出 ```info``` 中对应的平台类型添加到 ```targets``` 中.</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">-</span><br><span class="line"></span><br><span class="line">- 分享频道</span><br><span class="line"></span><br><span class="line">以 Objective-C 为例, 在 ```RShareManager``` 定义了分享通道枚举:</span><br><span class="line"></span><br><span class="line">```objc</span><br><span class="line">typedef NS_ENUM(NSInteger, RShareChannel) &#123;</span><br><span class="line">    RShareChannelQQSession, // QQ 好友</span><br><span class="line">    RShareChannelQQFavorite, // QQ 收藏</span><br><span class="line">    RShareChannelQQDataLine, // QQ 我的电脑(数据传输)</span><br><span class="line">    RShareChannelQZone, // QQ 空间</span><br><span class="line">    RShareChannelWechatSession, // 微信好友</span><br><span class="line">    RShareChannelWechatFavorite, // 微信收藏</span><br><span class="line">    RShareChannelWechatTimeline, // 微信朋友圈</span><br><span class="line">    RShareChannelFacebookClient, // Facebook 客户端</span><br><span class="line">    RShareChannelFacebookBroswer, // Facebook Feed 形式网页</span><br><span class="line">    RShareChannelTwitter,// 推特</span><br><span class="line">    RShareChannelSinaWeibo, // 新浪微博</span><br><span class="line">    RShareChannelSinaWeiboStory, // 新浪微博 - 我的故事</span><br><span class="line">    RShareChannelLine, // Line</span><br><span class="line">    RShareChannelInstagram, // Instagram</span><br><span class="line">    RShareChannelTumblr, // Tumblr</span><br><span class="line">    RShareChannelPinterest, // Pinterest</span><br><span class="line">    RShareChannelGooglePlus, // GooglePlus</span><br><span class="line">    RShareChannelWhatsApp // WhatsApp</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>-</p>
<ul>
<li>初始化以及注册平台</li>
</ul>
<p>由 ShareSDK iOS 版激发灵感进行构建.</p>
<figure class="highlight plain"><figcaption><span>通过单例创建, 实例函数 ```registerPlatforms:``` 为注册实例化子平台 Manager 的过程, Objective-C 中通过 ```runtime``` 实现:</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```objc</span><br><span class="line">// code snippet ...</span><br><span class="line">@autoreleasepool &#123;</span><br><span class="line">    Class cls = p.targets[i];</span><br><span class="line">    id obj = objc_msgSend(objc_msgSend(cls, @selector(alloc)), @selector(init));</span><br><span class="line">    SEL sel = @selector(connect:);</span><br><span class="line">    ((void(*)(id,SEL, RConfiguration))objc_msgSend)(obj, sel, c);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Swift 中暂时没找到类似的方法, 采用了原始的 <figure class="highlight plain"><figcaption><span>- case``` 逐个判断并初始化.</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">其中 ```RConfiguration``` 为:</span><br><span class="line"></span><br><span class="line">Objective-C:</span><br><span class="line"></span><br><span class="line">```objc</span><br><span class="line">// 定义在 RShare.h 中</span><br><span class="line">typedef void (^RConfiguration)(RShareSDKPlatform platform, RRegister* obj);</span><br></pre></td></tr></table></figure></p>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义在 RShareManager 中</span></span><br><span class="line"><span class="keyword">typealias</span> <span class="type">RConfiguration</span> = (<span class="number">_</span> paltform : <span class="type">RShareSDKPlatform</span>,<span class="number">_</span> obj : <span class="type">RRegister</span>) -&gt; <span class="type">Void</span></span><br></pre></td></tr></table></figure>
<p>每个平台都有 <figure class="highlight plain"><figcaption><span>函数, 参数是 ```RConfiguration``` 类型, 返回平台信息是因为不是所有的平台都需要初始化 SDK, 返回 ```RRegister``` 实例的目的是把实例化的工作交给 ```RRegister```去做.</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```RRegister``` 内部逻辑很简单, 只有初始化三方平台 SDK 的工作.</span><br><span class="line"></span><br><span class="line">-</span><br><span class="line"></span><br><span class="line">- 返回本应用</span><br><span class="line"></span><br><span class="line">Objective-C 中通过 ```runtime```实现:</span><br><span class="line"></span><br><span class="line">```objc</span><br><span class="line">- (BOOL)application:(UIApplication *)application openURL:(NSURL *)url options:(NSDictionary&lt;UIApplicationOpenURLOptionsKey,id&gt; *)options &#123; </span><br><span class="line">    SEL sel = @selector(application:openURL:options:);</span><br><span class="line">    id obj = objc_msgSend(objc_msgSend(_cls, @selector(alloc)), @selector(init));</span><br><span class="line">    return ((BOOL(*)(id,SEL,id,id,id))objc_msgSend)(obj, sel, application,url,options);</span><br><span class="line">&#125;</span><br><span class="line">``` </span><br><span class="line">其中 ```_cls``` 是在分享的时候通过分享接口中 ```channel``` 字段加以判断确定:</span><br><span class="line"></span><br><span class="line">```objc</span><br><span class="line">-(Class)getCls:(RShareChannel)channel &#123;</span><br><span class="line">    switch (channel) &#123;</span><br><span class="line">        case RShareChannelQQSession:</span><br><span class="line">        case RShareChannelQQFavorite:</span><br><span class="line">        case RShareChannelQQDataLine:</span><br><span class="line">        case RShareChannelQZone:</span><br><span class="line">            return RQqManager.class;</span><br><span class="line">            </span><br><span class="line">        case RShareChannelWechatSession:</span><br><span class="line">        case RShareChannelWechatFavorite:</span><br><span class="line">        case RShareChannelWechatTimeline:</span><br><span class="line">            return RWechatManager.class;</span><br><span class="line">            </span><br><span class="line">        case RShareChannelFacebookClient:</span><br><span class="line">        case RShareChannelFacebookBroswer:</span><br><span class="line">            return RFacebookManager.class;</span><br><span class="line">            </span><br><span class="line">        case RShareChannelTwitter:</span><br><span class="line">            return RTwitterManager.class;</span><br><span class="line">            </span><br><span class="line">        case RShareChannelSinaWeibo:</span><br><span class="line">        case RShareChannelSinaWeiboStory:</span><br><span class="line">           return RSinaWeiboManager.class;</span><br><span class="line">            </span><br><span class="line">        case RShareChannelLine:</span><br><span class="line">            return RLineManager.class;</span><br><span class="line">            </span><br><span class="line">        case RShareChannelInstagram:</span><br><span class="line">            return RInstagramManager.class;</span><br><span class="line">        case RShareChannelTumblr:</span><br><span class="line">            return RTumblrManager.class;</span><br><span class="line">        case RShareChannelPinterest:</span><br><span class="line">            return RPinterestManager.class;</span><br><span class="line">        case RShareChannelGooglePlus:</span><br><span class="line">            return RGooglePlusManager.class;</span><br><span class="line">        case RShareChannelWhatsApp:</span><br><span class="line">            return RWhatsAppManager.class;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>Swift 中同样用了这种办法解决:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">application</span><span class="params">(<span class="number">_</span> app: UIApplication, <span class="keyword">open</span> url: URL, options: [UIApplicationOpenURLOptionsKey : Any] = [:])</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> objCls.application(app, <span class="keyword">open</span>: url, options : options)     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="4-5-接口"><a href="#4-5-接口" class="headerlink" title="4.5 接口"></a>4.5 接口</h5><p><strong>添加平台及初始化需要注册的平台:</strong></p>
<p>Objective-C:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">BOOL</span>)application:(<span class="built_in">UIApplication</span> *)application didFinishLaunchingWithOptions:(<span class="built_in">NSDictionary</span> *)launchOptions &#123;</span><br><span class="line">    </span><br><span class="line">    RPlatform* p = [RPlatform make:^(PlatformBuilder *builder) &#123;</span><br><span class="line">        [builder add:RShareSDKPinterest];</span><br><span class="line">        [builder add:RShareSDKWhatsApp];</span><br><span class="line">        [builder add:RShareSDKWechat];</span><br><span class="line">        [builder add:RShareSDKSina];</span><br><span class="line">        [builder add:RShareSDKQQ];</span><br><span class="line">        [builder add:RShareSDKTumblr];</span><br><span class="line">        [builder add:RShareSDKFacebook];</span><br><span class="line">        [builder add:RShareSDKTwitter];</span><br><span class="line">        [builder add:RShareSDKLine];</span><br><span class="line">        [builder add:RShareSDKGooglePlus];</span><br><span class="line">        [builder add:RShareSDKInstagram];</span><br><span class="line">    &#125;];</span><br><span class="line">    </span><br><span class="line">    [[RShareManager shared] registerPlatforms:p onConfiguration:^(RShareSDKPlatform platform, RRegister *obj) &#123;</span><br><span class="line">        <span class="keyword">switch</span> (platform) &#123;</span><br><span class="line">            <span class="keyword">case</span> RShareSDKPinterest:</span><br><span class="line">                [obj connectPinterestByAppID: yourAppID appSecret: <span class="literal">nil</span>];</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> RShareSDKQQ:</span><br><span class="line">                [obj connectQQByAppID:yourAppID appKey: yourKey];</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                </span><br><span class="line">            <span class="keyword">case</span> RShareSDKSina:</span><br><span class="line">                [obj connectSinaWeiboByAppKey: yourKey  appSecret:yourSecret];</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> RShareSDKWechat:</span><br><span class="line">                [obj connectWechatByAppID: yourAppID appSecret:yourSecret];</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> RShareSDKTumblr:</span><br><span class="line">                [obj conncetTumblrByConsumerKey: yourKey  consumerSecret: yourSecret];</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> RShareSDKFacebook:</span><br><span class="line">                [obj connectFacebookByID:yourAppID secret:<span class="literal">nil</span>];</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> RShareSDKTwitter:</span><br><span class="line">                [obj connectTwitterByConsumerKey:yourKey consumerSecret:yourSecret];</span><br><span class="line">                </span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">application</span><span class="params">(<span class="number">_</span> application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: Any]?)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> platform = <span class="type">RPlatform</span>.make &#123; (builder) <span class="keyword">in</span></span><br><span class="line">        builder.add(p: .<span class="type">Facebook</span>)</span><br><span class="line">        builder.add(p: .<span class="type">Twitter</span>)</span><br><span class="line">        builder.add(p: .<span class="type">QQ</span>)</span><br><span class="line">        builder.add(p: .<span class="type">Wechat</span>)</span><br><span class="line">        builder.add(p: .<span class="type">Instagram</span>)</span><br><span class="line">        builder.add(p: .<span class="type">Tumblr</span>)</span><br><span class="line">        builder.add(p: .<span class="type">Pinterest</span>)</span><br><span class="line">        builder.add(p: .<span class="type">Sina</span>)</span><br><span class="line">        builder.add(p: .<span class="type">GooglePlus</span>)</span><br><span class="line">        builder.add(p: .<span class="type">Line</span>)</span><br><span class="line">        builder.add(p: .<span class="type">WhatsApp</span>)       </span><br><span class="line">            </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">RShareManager</span>.shared.registerPlatform(platform: platform) &#123; (p, obj) <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">switch</span> p &#123;</span><br><span class="line">            <span class="keyword">case</span> .<span class="type">Facebook</span>:</span><br><span class="line">                obj.connectFacebook(appID: yourAppID, secret: <span class="literal">nil</span>)</span><br><span class="line">            <span class="keyword">case</span> .<span class="type">Pinterest</span>:</span><br><span class="line">                obj.connectPinterest(appID: yourAppID, secret: <span class="literal">nil</span>)</span><br><span class="line">            <span class="keyword">case</span> .<span class="type">QQ</span>:</span><br><span class="line">                obj.connectQQ(appID: yourAppID, key: yourKey)</span><br><span class="line">            <span class="keyword">case</span> .<span class="type">Sina</span>:</span><br><span class="line">                obj.connectSinaWeibo(appKey: yourKey, secret: yourSecret)</span><br><span class="line">            <span class="keyword">case</span> .<span class="type">Wechat</span>:</span><br><span class="line">                obj.connectWechat(appID: yourAppID, secret: yourSecret)</span><br><span class="line">            <span class="keyword">case</span> .<span class="type">Tumblr</span>:</span><br><span class="line">                obj.connectTumblr(consumerKey: yourKey, secret: yourSecret)</span><br><span class="line">            <span class="keyword">case</span> .<span class="type">Twitter</span>:</span><br><span class="line">                obj.connectTwitter(consumerKey: yourKey, secret: yourSecret)</span><br><span class="line">            <span class="keyword">default</span> : <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>构建分享模型:</strong></p>
<p>以 <figure class="highlight plain"><figcaption><span>为例:</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Objective-C:</span><br><span class="line"></span><br><span class="line">```objc</span><br><span class="line">RImageContent* content = RImageContent make:^(RImageContentBuilder *builder) &#123;</span><br><span class="line">     // ...   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RImageContent</span>.make &#123; (builder) <span class="keyword">in</span></span><br><span class="line">    <span class="comment">// ...    </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>分享：</strong></p>
<p>以分享 <figure class="highlight plain"><figcaption><span>为例:</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Objective-C:</span><br><span class="line"></span><br><span class="line">```objc</span><br><span class="line">[RShareManager shared] shareImageWithContent:content channel: channel from: context completion:^(RShareSDKPlatform platform, ShareResult result, NSString * _Nullable errorInfo) &#123;</span><br><span class="line">     // ...   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RShareManager</span>.shared.shareImage(content: content, channel: channel, from: context) &#123; (platform, result, errorInfo <span class="keyword">in</span></span><br><span class="line">    <span class="comment">// ...    </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>返回本应用:</strong></p>
<p>Objective-C:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[RShareManager shared]application:app openURL:url options:options];</span><br></pre></td></tr></table></figure>
<p>Swift:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RShareManager</span>.shared.application(app, <span class="keyword">open</span>: url, options : options)</span><br></pre></td></tr></table></figure>
<p>-</p>
<h3 id="5-源码"><a href="#5-源码" class="headerlink" title="5 源码"></a>5 源码</h3><p><a href="https://github.com/rexzx/rshare_objective_c" target="_blank" rel="noopener">Objective-C 版本源码</a>、 <a href="https://github.com/rexzx/rshare_swift" target="_blank" rel="noopener">Swift 版本源码</a>, 还在学习中, 请多指教.</p>

      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/07/27/Hello-World/" rel="prev" title="Hello World">
                Hello World <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/logo.jpg"
                alt="" />
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description">曾經滄海難為水 除卻巫山不是雲</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">2</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">4</span>
                    <span class="site-state-item-name">tags</span>
                  
                </div>
              
            </nav>
          

          

          

          
          

          
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#「RSHARE」-一键分享-iOS-版"><span class="nav-number">1.</span> <span class="nav-text">「RSHARE」 一键分享 iOS 版</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#测试设备"><span class="nav-number">1.0.1.</span> <span class="nav-text">测试设备</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-支持平台"><span class="nav-number">1.0.2.</span> <span class="nav-text">1 支持平台</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-平台差异"><span class="nav-number">1.0.2.1.</span> <span class="nav-text">1.1 平台差异</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-QQ"><span class="nav-number">1.0.2.2.</span> <span class="nav-text">3.1 QQ</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#3-1-1-准备"><span class="nav-number">1.0.2.2.1.</span> <span class="nav-text">3.1.1 准备</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-1-2-集成"><span class="nav-number">1.0.2.2.2.</span> <span class="nav-text">3.1.2 集成</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-1-3-接口调用及内部实现"><span class="nav-number">1.0.2.2.3.</span> <span class="nav-text">3.1.3 接口调用及内部实现</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-微信"><span class="nav-number">1.0.2.3.</span> <span class="nav-text">3.2 微信</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#3-2-1-准备"><span class="nav-number">1.0.2.3.1.</span> <span class="nav-text">3.2.1 准备</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-2-2-集成"><span class="nav-number">1.0.2.3.2.</span> <span class="nav-text">3.2.2 集成</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-2-3-接口调用及内部实现"><span class="nav-number">1.0.2.3.3.</span> <span class="nav-text">3.2.3 接口调用及内部实现</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-新浪"><span class="nav-number">1.0.2.4.</span> <span class="nav-text">3.3 新浪</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#3-3-1-准备"><span class="nav-number">1.0.2.4.1.</span> <span class="nav-text">3.3.1 准备</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-3-2-集成"><span class="nav-number">1.0.2.4.2.</span> <span class="nav-text">3.3.2 集成</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-3-3-接口调用及内部实现"><span class="nav-number">1.0.2.4.3.</span> <span class="nav-text">3.3.3 接口调用及内部实现</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-Facebook"><span class="nav-number">1.0.2.5.</span> <span class="nav-text">3.4 Facebook</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#3-4-1-准备"><span class="nav-number">1.0.2.5.1.</span> <span class="nav-text">3.4.1 准备</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-4-2-集成"><span class="nav-number">1.0.2.5.2.</span> <span class="nav-text">3.4.2 集成</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-4-3-接口调用及内部实现"><span class="nav-number">1.0.2.5.3.</span> <span class="nav-text">3.4.3 接口调用及内部实现</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-5-Twitter"><span class="nav-number">1.0.2.6.</span> <span class="nav-text">3.5 Twitter</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#3-5-1-准备"><span class="nav-number">1.0.2.6.1.</span> <span class="nav-text">3.5.1 准备</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-5-2-集成"><span class="nav-number">1.0.2.6.2.</span> <span class="nav-text">3.5.2 集成</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-5-3-接口调用及内部实现"><span class="nav-number">1.0.2.6.3.</span> <span class="nav-text">3.5.3 接口调用及内部实现</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-6-3-接口调用及内部实现"><span class="nav-number">1.0.2.6.4.</span> <span class="nav-text">3.6.3 接口调用及内部实现</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-7-Tumblr"><span class="nav-number">1.0.2.7.</span> <span class="nav-text">3.7 Tumblr</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#3-7-1-准备"><span class="nav-number">1.0.2.7.1.</span> <span class="nav-text">3.7.1 准备</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-7-2-集成"><span class="nav-number">1.0.2.7.2.</span> <span class="nav-text">3.7.2 集成</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-8-Pinterest"><span class="nav-number">1.0.2.8.</span> <span class="nav-text">3.8 Pinterest</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#3-8-1-准备"><span class="nav-number">1.0.2.8.1.</span> <span class="nav-text">3.8.1 准备</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-8-2-集成"><span class="nav-number">1.0.2.8.2.</span> <span class="nav-text">3.8.2 集成</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-8-3-接口调用及内部实现"><span class="nav-number">1.0.2.8.3.</span> <span class="nav-text">3.8.3 接口调用及内部实现</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-9-Line"><span class="nav-number">1.0.2.9.</span> <span class="nav-text">3.9 Line</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#3-9-1-准备"><span class="nav-number">1.0.2.9.1.</span> <span class="nav-text">3.9.1 准备</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-9-2-配置"><span class="nav-number">1.0.2.9.2.</span> <span class="nav-text">3.9.2 配置</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-9-3-接口调用及内部实现"><span class="nav-number">1.0.2.9.3.</span> <span class="nav-text">3.9.3 接口调用及内部实现</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-10-WhatsApp"><span class="nav-number">1.0.2.10.</span> <span class="nav-text">3.10 WhatsApp</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#3-10-1-准备"><span class="nav-number">1.0.2.10.1.</span> <span class="nav-text">3.10.1 准备</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-10-2-配置"><span class="nav-number">1.0.2.10.2.</span> <span class="nav-text">3.10.2 配置</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-10-3-接口调用及内部实现"><span class="nav-number">1.0.2.10.3.</span> <span class="nav-text">3.10.3 接口调用及内部实现</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-11-GooglePlus"><span class="nav-number">1.0.2.11.</span> <span class="nav-text">3.11 GooglePlus</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#3-11-1-准备"><span class="nav-number">1.0.2.11.1.</span> <span class="nav-text">3.11.1 准备</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-11-2-接口调用及内部实现"><span class="nav-number">1.0.2.11.2.</span> <span class="nav-text">3.11.2 接口调用及内部实现</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-统一分享接口"><span class="nav-number">1.0.3.</span> <span class="nav-text">4 统一分享接口</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#4-1-缺陷"><span class="nav-number">1.0.3.0.1.</span> <span class="nav-text">4.1 缺陷</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-2-类图"><span class="nav-number">1.0.3.0.2.</span> <span class="nav-text">4.2 类图</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-5-接口"><span class="nav-number">1.0.3.0.3.</span> <span class="nav-text">4.5 接口</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-源码"><span class="nav-number">1.0.4.</span> <span class="nav-text">5 源码</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder"></span>

  

  
</div>




  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> v3.7.1</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://theme-next.org">NexT.Pisces</a> v6.3.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.3.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.3.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.3.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.3.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.3.0"></script>



  



  










  





  

  

  

  

  
  

  

  

  

  

  

</body>
</html>
